
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.collection.dao.purchase.PurchaseMapper">
    
	<select id="getPurchaseList" parameterType="map" resultType="map">
	    select ctfu.isread,ctpo.orderid,ctpo.companyid,ctpo.orderno,ctpo.organizeid,ctpo.examineuserid,ctpo.createid,ctpo.opinion,ctpo.result,DATE_FORMAT(ctfu.createtime,'%Y-%m-%d %H:%i:%S') as createtime,DATE_FORMAT(ctpo.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctpo.updateid,ctpo.status,
	    DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createdate,DATE_FORMAT(ctfu.createtime,'%H:%i') as createhour,ctpo.materialprice,ctfu.forwarduserid,ctpo.maternum,
	    ctuu.realname as createname,ctuu1.realname as examinename
	    from c_t_use_purchase_order ctpo
	    right join c_t_use_forward_user ctfu on ctfu.resourceid=ctpo.orderid and resourcetype=1
	    left join c_t_use_userinfo ctuu on ctpo.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctpo.examineuserid=ctuu1.userid
	    <where>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctpo.companyid=#{companyid}</if>
	        <if test="status != null">and ctpo.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
	        and ctpo.delflag=0 and ctfu.delflag=0
	    </where>
	    order by ctfu.createtime desc
	    <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
	</select>
	<select id="getPurchaseListNum" parameterType="map" resultType="int">
	    select count(0) from c_t_use_purchase_order ctpo
	    right join c_t_use_forward_user ctfu on ctfu.resourceid=ctpo.orderid and resourcetype=1
	    <where>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctpo.companyid=#{companyid}</if>
	        <if test="status != null">and ctpo.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
	        <if test="isread != null">and ctfu.isread=#{isread}</if>
	        and ctpo.delflag=0 and ctfu.delflag=0
	    </where>
	</select>
	<select id="getPurchaseInfo" parameterType="map" resultType="map">
	    select ctpo.orderid,ctpo.companyid,ctpo.orderno,ctpo.organizeid,ctpo.examineuserid,ctpo.createid,ctpo.opinion,ctpo.result,DATE_FORMAT(ctpo.createtime,'%Y-%m-%d %H:%i:%S') as createtime,DATE_FORMAT(ctpo.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctpo.updateid,ctpo.status,
	    ctuu.realname as createname,ctuu1.realname as examinename,ctpo.materialprice,ctpo.maternum,ctuo.organizename,
	    ctuu.headimage as createheadimage,ctuu1.headimage as examineheadimage,ctpo.CCuserids,ifnull(ctpo.CCusernames,"") as CCusernames,ctpo.purchasetime,ifnull(ctpo.payamount,0) as payamount
	    from c_t_use_purchase_order ctpo
	    left join c_t_use_userinfo ctuu on ctpo.createid=ctuu.userid
	    left join c_t_use_userinfo ctuu1 on ctpo.examineuserid=ctuu1.userid
	    left join c_t_use_organize ctuo on ctpo.organizeid=ctuo.organizeid
	    <where>
	        <if test="orderid != null and orderid != ''">and ctpo.orderid=#{orderid}</if>
	    </where>
	    limit 1
	</select>
	<!-- 采购(入库)单 已处理 列表 -->
	<select id="getPurchaseListByDate" parameterType="map" resultType="map">
	    select DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createtime,COUNT(0) as count from c_t_use_purchase_order ctpo
	    left join c_t_use_forward_user ctfu on ctfu.resourceid=ctpo.orderid and resourcetype=1
		<where>
		    <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctpo.companyid=#{companyid}</if>
	        <if test="status != null">and ctpo.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
	        and ctpo.delflag=0 and ctfu.delflag=0
	    </where>
	    group by DATE_FORMAT(ctfu.createtime,'%Y-%m-%d')
	    order by DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') desc
		<if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
	</select>
	<select id="getPurchaseListByDateNum" parameterType="map" resultType="int">
	    select count(0) from (
	    select DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createtime,COUNT(0) as count from c_t_use_purchase_order ctpo
	    left join c_t_use_forward_user ctfu on ctfu.resourceid=ctpo.orderid and resourcetype=1
		<where>
		    <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctpo.companyid=#{companyid}</if>
	        <if test="status != null">and ctpo.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
	        <if test="isread != null">and ctfu.isread=#{isread}</if>
	        and ctpo.delflag=0 and ctfu.delflag=0 and ctfu.delflag=0
	    </where>
	    group by DATE_FORMAT(ctfu.createtime,'%Y-%m-%d')
	    )a
	</select>
	
	<select id="getPurchaseByDate" parameterType="map" resultType="map">
	    select ctfu.isread,ctpo.orderid,ctpo.companyid,ctpo.orderno,ctpo.organizeid,ctpo.examineuserid,ctpo.createid,ctpo.opinion,ctpo.result,DATE_FORMAT(ctfu.createtime,'%H:%i:%S') as createtime,DATE_FORMAT(ctpo.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctpo.updateid,ctpo.status,
	    DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createdate,DATE_FORMAT(ctfu.createtime,'%H:%i') as createhour,ctpo.materialprice,ctfu.forwarduserid,ctpo.maternum,
	    ctuu.realname as createname,ctuu1.realname as examinename,ctfu.createid sendid,ctfu.issend
	    from c_t_use_purchase_order ctpo
	    right join c_t_use_forward_user ctfu on ctfu.resourceid=ctpo.orderid and resourcetype=1
	    left join c_t_use_userinfo ctuu on ctpo.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctpo.examineuserid=ctuu1.userid
	    <where>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctpo.companyid=#{companyid}</if>
	        <if test="status != null">and ctpo.status=#{status}</if>
	        <if test="createtime != null and createtime != ''">and DATE_FORMAT(ctfu.createtime,'%Y-%m-%d')=#{createtime}</if>
	        and ctpo.delflag=0 and ctfu.delflag=0
	    </where>
	</select>
	
	<!-- 采购(入库)单 根据 物料名称查询 -->
	<select id="getPurchaseDateByname" parameterType="map" resultType="map">
	    select DATE_FORMAT(a.createtime,'%Y-%m-%d') AS createtime,COUNT(0) as count from 
	    (select ctpo.* 
	    from c_t_use_purchase_order ctpo
	    left join c_t_use_purchase_materiel ctupm on ctpo.orderid=ctupm.orderid
		<where>
	        <if test="name != null and name != ''">and ctupm.name=#{name}</if>
	        <if test="companyid != null and companyid != ''">and ctpo.companyid=#{companyid}</if>
	        <if test="organizeid != null and organizeid != ''">and ctpo.organizeid=#{organizeid}</if>
	        <if test="unit != null and unit != ''">and ctupm.unit=#{unit}</if>
	        and ctpo.delflag=0
	    </where>
	    group by ctpo.orderid
	    ) a 
	    group by DATE_FORMAT(a.createtime,'%Y-%m-%d')
		<if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
	</select>
	<select id="getPurchaseDateBynameNum" parameterType="map" resultType="int">
	    select count(0) from (
	    select DATE_FORMAT(a.createtime,'%Y-%m-%d') AS createtime,COUNT(0) as count from 
	    (select ctpo.* 
	    from c_t_use_purchase_order ctpo
	    left join c_t_use_purchase_materiel ctupm on ctpo.orderid=ctupm.orderid
		<where>
	        <if test="name != null and name != ''">and ctupm.name=#{name}</if>
	        <if test="companyid != null and companyid != ''">and ctpo.companyid=#{companyid}</if>
	        <if test="organizeid != null and organizeid != ''">and ctpo.organizeid=#{organizeid}</if>
	        <if test="unit != null and unit != ''">and ctupm.unit=#{unit}</if>
	        and ctpo.delflag=0
	    </where>
	    group by ctpo.orderid
	    ) a 
	    group by DATE_FORMAT(a.createtime,'%Y-%m-%d')
	    ) b
	</select>
	
	<select id="getOrderListByDate" parameterType="map" resultType="map">
	    select ctpo.* 
	    from c_t_use_purchase_order ctpo
	    left join c_t_use_purchase_materiel ctupm on ctpo.orderid=ctupm.orderid
		<where>
	        <if test="name != null and name != ''">and ctupm.name=#{name}</if>
	        <if test="companyid != null and companyid != ''">and ctpo.companyid=#{companyid}</if>
	        <if test="organizeid != null and organizeid != ''">and ctpo.organizeid=#{organizeid}</if>
	        <if test="unit != null and unit != ''">and ctupm.unit=#{unit}</if>
	        <if test="createtime != null and createtime != ''">and DATE_FORMAT(ctpo.createtime,'%Y-%m-%d')=#{createtime}</if>
	        and ctpo.delflag=0
	    </where>
	    group by ctpo.orderid
	</select>
	<!-- 申购单 已处理 -->
	<select id="getApplyOrderByDate" parameterType="map" resultType="map">
	    select DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createtime,COUNT(0) as count
	    from c_t_use_apply_order ctao
	    right join c_t_use_forward_user ctfu on ctfu.resourceid=ctao.orderid and resourcetype=2
		<where>
		    <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctao.companyid=#{companyid}</if>
	        <if test="status != null">and ctao.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
	        and ctfu.delflag=0 and ctfu.delflag=0
	    </where>
	    group by DATE_FORMAT(ctfu.createtime,'%Y-%m-%d')
	    order by DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') desc
		<if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
	</select>
	<select id="getApplyOrderByDateNum" parameterType="map" resultType="int">
	    select count(0) from (select DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createtime,COUNT(0) as count
	    from c_t_use_apply_order ctao
	    right join c_t_use_forward_user ctfu on ctfu.resourceid=ctao.orderid and resourcetype=2
		<where>
		    <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctao.companyid=#{companyid}</if>
	        <if test="status != null">and ctao.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
	        <if test="isread != null">and ctfu.isread=#{isread}</if>
	        and ctfu.delflag=0 and ctfu.delflag=0
	    </where>
	    group by DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') 
	    ) b
	</select>
	
	<select id="getApplyListByDate" parameterType="map" resultType="map">
	    select ctfu.isread,ctao.orderid,ctao.companyid,ctao.orderno,ctao.organizeid,ctao.examineuserid,ctao.createid,ctao.opinion,ctao.result,DATE_FORMAT(ctao.createtime,'%H:%i:%S') as createtime,DATE_FORMAT(ctao.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctao.updateid,ctao.status,
	    ctuu.realname as createname,ctuu1.realname as examinename,ctao.materialprice,ctuo.organizename,ctao.maternum,ctfu.createid sendid,ctfu.issend,ctfu.forwarduserid
	    from c_t_use_apply_order ctao
	    right join c_t_use_forward_user ctfu on ctfu.resourceid=ctao.orderid and resourcetype=2
	    left join c_t_use_userinfo ctuu on ctao.createid=ctuu.userid
	    left join c_t_use_userinfo ctuu1 on ctao.examineuserid=ctuu1.userid
	    left join c_t_use_organize ctuo on ctao.organizeid=ctuo.organizeid
	    <where>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctao.companyid=#{companyid}</if>
	        <if test="status != null">and ctao.status=#{status}</if>
	        <if test="createtime != null and createtime != ''">and DATE_FORMAT(ctfu.createtime,'%Y-%m-%d')=#{createtime}</if>
	        and ctfu.delflag=0 and ctfu.delflag=0
	    </where>
	    order by ctfu.createtime desc
	</select>
	
	<select id="getShopList" parameterType="map" resultType="map">
	    select organizeid,datacode,companyid,organizename,type,parentid,address,DATE_FORMAT(createtime,'%Y-%m-%d %H:%i:%S') as createtime,DATE_FORMAT(updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,updateid,status
	    from c_t_use_organize
	    <where>
	        <if test="companyid != null and companyid != ''">and companyid=#{companyid}</if>
	        and delflag=0
	    </where>
	    order by priority
	</select>
	<insert id="insertPurchase" parameterType="map">
	    insert into c_t_use_purchase_order
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="orderid != null and orderid != ''">orderid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="orderno != null and orderno != ''">orderno,</if>
	        <if test="organizeid != null and organizeid != ''">organizeid,</if>
	        <if test="examineuserid != null and examineuserid != ''">examineuserid,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="opinion != null and opinion != ''">opinion,</if>
	        <if test="result != null">result,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="status != null">status,</if>
	        <if test="materialprice != null">materialprice,</if>
	        <if test="datacode != null and datacode != ''">datacode,</if>
	        <if test="delflag != null">delflag,</if>
	        <if test="maternum != null">maternum,</if>
	        <if test="CCuserids != null and CCuserids != ''">CCuserids,</if>
	        <if test="CCusernames != null and CCusernames != ''">CCusernames,</if>
	        <if test="purchasetime != null and purchasetime != ''">purchasetime,</if>
	        <if test="payamount != null and payamount != ''">payamount,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="orderid != null and orderid != ''">#{orderid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="orderno != null and orderno != ''">#{orderno},</if>
	        <if test="organizeid != null and organizeid != ''">#{organizeid},</if>
	        <if test="examineuserid != null and examineuserid != ''">#{examineuserid},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="opinion != null and opinion != ''">#{opinion},</if>
	        <if test="result != null">#{result},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="status != null">#{status},</if>
	        <if test="materialprice != null">#{materialprice},</if>
	        <if test="datacode != null and datacode != ''">#{datacode},</if>
	        <if test="delflag != null">#{delflag},</if>
	        <if test="maternum != null">#{maternum},</if>
	        <if test="CCuserids != null and CCuserids != ''">#{CCuserids},</if>
	        <if test="CCusernames != null and CCusernames != ''">#{CCusernames},</if>
	        <if test="purchasetime != null and purchasetime != ''">#{purchasetime},</if>
	        <if test="payamount != null and payamount != ''">#{payamount},</if>
	    </trim>
	</insert>
	<insert id="insertPurchaseMaterial" parameterType="map">
	   	insert into c_t_use_purchase_materiel
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="materielid != null and materielid != ''">materielid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="orderid != null and orderid != ''">orderid,</if>
	        <if test="supplierid != null and supplierid != ''">supplierid,</if>
	        <if test="type != null and type != ''">type,</if>
	        <if test="name != null and name != ''">name,</if>
	        <if test="specifications != null and specifications != ''">specifications,</if>
	        <if test="price != null and price != ''">price,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="status != null">status,</if>
	        <if test="num != null">num,</if>
	        <if test="sumprice != null and sumprice != ''">sumprice,residualmoney,</if>
	        <if test="delflag != null">delflag,</if>
	        <if test="stock != null">stock,</if>
	        <if test="unit != null and unit != ''">unit,</if>
	        <if test="specificationsone != null and specificationsone != ''">specificationsone,</if>
	        <if test="specificationstwo != null and specificationstwo != ''">specificationstwo,</if>
	        <if test="realprice != null and realprice != ''">realprice,</if>
	        <if test="realnum != null and realnum != ''">realnum,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="materielid != null and materielid != ''">#{materielid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="orderid != null and orderid != ''">#{orderid},</if>
	        <if test="supplierid != null and supplierid != ''">#{supplierid},</if>
	        <if test="type != null and type != ''">#{type},</if>
	        <if test="name != null and name != ''">#{name},</if>
	        <if test="specifications != null and specifications != ''">#{specifications},</if>
	        <if test="price != null and price != ''">#{price},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="status != null">#{status},</if>
	        <if test="num != null">#{num},</if>
	        <if test="sumprice != null and sumprice != ''">#{sumprice},#{sumprice},</if>
	        <if test="delflag != null">#{delflag},</if>
	        <if test="stock != null">#{stock},</if>
	        <if test="unit != null and unit != ''">#{unit},</if>
	        <if test="specificationsone != null and specificationsone != ''">#{specificationsone},</if>
	        <if test="specificationstwo != null and specificationstwo != ''">#{specificationstwo},</if>
	        <if test="realprice != null and realprice != ''">#{realprice},</if>
	        <if test="realnum != null and realnum != ''">#{realnum},</if>
	    </trim>
	</insert>
	<select id="getPurchaseMaterialList" parameterType="map" resultType="map">
	    select ctupm.materielid,ctupm.companyid,ctupm.orderid,ctupm.supplierid,ctupm.type,ctupm.name,ifnull(ctupm.specifications,"") as specifications,ctupm.price,ctupm.num,ctupm.residualmoney,ctupm.sumprice,DATE_FORMAT(ctupm.createtime,'%Y-%m-%d %H:%i:%S') as createtime,DATE_FORMAT(ctupm.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctupm.updateid,ctupm.status,
	    ifnull(ctupm.unit,"") as unit,ifnull(ctmdd.cname,"") as specificationsonevalue,ifnull(ctmdd1.cname,"") as specificationstwovalue,
	    ifnull(ctus.suppliername,"") as suppliername,
	    ifnull(ctmdd1.cname,"") as specificationstwo,ifnull(ctmdd.cname,"") as specificationsone,ctupm.stock,
	    concat(ifnull(ctupm.specifications,""),ifnull(ctmdd1.cname,""),ifnull(case ctmdd.cname when null then "" else CONCAT("/",ctmdd.cname) end,"")) AS specificationsall,
	    ctupm.realprice,ctupm.realnum
	    from c_t_use_purchase_materiel ctupm
	    left join c_t_manage_dict_data ctmdd on ctmdd.dataid=ctupm.specificationsone 
	    left join c_t_manage_dict_data ctmdd1 on ctmdd1.dataid=ctupm.specificationstwo
	    left join c_t_use_supplier ctus on ctupm.supplierid=ctus.supplierid
	    left join c_t_use_purchase_order ctupo on ctupm.orderid=ctupo.orderid
	    <where>
	        <if test="orderid !=null and orderid !=''">and ctupm.orderid=#{orderid}</if>
	        <if test="companyid != null and companyid != ''">and ctupm.companyid=#{companyid}</if>
	        <if test="organizeid != null and organizeid != ''">and ctupo.organizeid=#{organizeid}</if>
	        <if test="name != null and name != ''">and ctupm.name=#{name}</if>
	        <if test="type != null and type != ''">and ctupm.type=#{type}</if>
	        <if test="unit != null and unit != ''">and ctupm.unit=#{unit}</if>
	        <if test="specificationsall != null and specificationsall != ''">and concat(ifnull(ctupm.specifications,""),ifnull(ctmdd1.cname,""),ifnull(case ctmdd.cname when null then "" else CONCAT("/",ctmdd.cname) end,""))=#{specificationsall}</if>
	        <if test="result != null">and ctupo.result=#{result}</if>
	        and ctupm.delflag=0 and ctupm.stock > 0
	    </where>
	    <if test="groupname !=null ">group by ctupm.name</if>
	    <if test="grouptype !=null ">group by ctupm.type</if>
	    <if test="groupspecifications !=null ">group by concat(ifnull(ctupm.specifications,""),ifnull(ctmdd1.cname,""),ifnull(case ctmdd.cname when null then "" else CONCAT("/",ctmdd.cname) end,""))</if>
	    order by ctupm.createtime
	</select>
	
	<select id="getPurchaseMaterialListnew" parameterType="map" resultType="map">
	    select ctupm.materielid,ctupm.companyid,ctupm.orderid,ctupm.supplierid,ctupm.type,ctupm.name,ifnull(ctupm.specifications,"") as specifications,ctupm.price,ctupm.num,ctupm.sumprice,DATE_FORMAT(ctupm.createtime,'%Y-%m-%d %H:%i:%S') as createtime,DATE_FORMAT(ctupm.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctupm.updateid,ctupm.status,
	    ifnull(ctupm.unit,"") as unit,ifnull(ctmdd.cname,"") as specificationsonevalue,ifnull(ctmdd1.cname,"") as specificationstwovalue,
	    ifnull(ctus.suppliername,"") as suppliername,
	    ifnull(ctmdd1.cname,"") as specificationstwo,ifnull(ctmdd.cname,"") as specificationsone,ctupm.stock,
	    concat(ifnull(ctupm.specifications,""),ifnull(ctmdd1.cname,""),ifnull(case ctmdd.cname when null then "" else CONCAT("/",ctmdd.cname) end,"")) AS specificationsall,
	    ctupm.realprice,ctupm.realnum
	    from c_t_use_purchase_materiel ctupm
	    left join c_t_manage_dict_data ctmdd on ctmdd.dataid=ctupm.specificationsone 
	    left join c_t_manage_dict_data ctmdd1 on ctmdd1.dataid=ctupm.specificationstwo
	    left join c_t_use_supplier ctus on ctupm.supplierid=ctus.supplierid
	    left join c_t_use_purchase_order ctupo on ctupm.orderid=ctupo.orderid
	    <where>
	        <if test="orderid !=null and orderid !=''">and ctupm.orderid=#{orderid}</if>
	        <if test="companyid != null and companyid != ''">and ctupm.companyid=#{companyid}</if>
	        <if test="organizeid != null and organizeid != ''">and ctupo.organizeid=#{organizeid}</if>
	        <if test="name != null and name != ''">and ctupm.name=#{name}</if>
	        <if test="type != null and type != ''">and ctupm.type=#{type}</if>
	        <if test="unit != null and unit != ''">and ctupm.unit=#{unit}</if>
	        <if test="specificationsall != null and specificationsall != ''">and concat(ifnull(ctupm.specifications,""),ifnull(ctmdd1.cname,""),ifnull(case ctmdd.cname when null then "" else CONCAT("/",ctmdd.cname) end,""))=#{specificationsall}</if>
	        <if test="result != null">and ctupo.result=#{result}</if>
	        and ctupm.delflag=0
	    </where>
	    <if test="groupname !=null ">group by ctupm.name</if>
	    <if test="grouptype !=null ">group by ctupm.type</if>
	    <if test="groupspecifications !=null ">group by concat(ifnull(ctupm.specifications,""),ifnull(ctmdd1.cname,""),ifnull(case ctmdd.cname when null then "" else CONCAT("/",ctmdd.cname) end,""))</if>
	    order by ctupm.createtime
	</select>
	
	<select id="getPurchaseCommentList" parameterType="map" resultType="map">
	    select 
	         ctuc.commentid,
	         ctuc.content,
	         ctuc.userid,
			 ctuc.resourceid,
			 DATE_FORMAT(ctuc.createtime,'%Y-%m-%d %H:%i') as createtime,
			 ifnull(ctuc.parentid,"")as parentid,
			 ifnull(ctuc.resourcetype,"")as resourcetype,
			 DATE_FORMAT(ctuc.updatetime,'%Y-%m-%d %H:%i') as updatetime,
			 ifnull(ctuc.updateid,"")as updateid,
			 ifnull(ctuc.status,"")as status,
		     ifnull(ctuu.realname,"")as realname,
			 ifnull(ctuu.headimage,"")as headimage,
			 ifnull(ctuu1.realname,"") as replyname,
			 ifnull(ctuc.type,"") as type,
			 ifnull(ctuc.forwardusernames,"") as forwardusernames,
			 ifnull(ctuc.forwarduserids,"") as forwarduserids
		from c_t_use_comment ctuc
		     left join c_t_use_userinfo ctuu on ctuu.userid=ctuc.userid
		     left join c_t_use_comment ctuc1 on ctuc.parentid=ctuc1.commentid
		     left join c_t_use_userinfo ctuu1 on ctuc1.userid=ctuu1.userid
	    <where>
	        <if test="orderid != null and orderid!= ''">and ctuc.resourceid=#{orderid}</if>
	        <if test="resourcetype !=null">and ctuc.resourcetype=#{resourcetype}</if>
	    </where>
	     order by ctuc.createtime desc
	    <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
	</select>
	<select id="getPurchaseCommentListNum" parameterType="map" resultType="int">
	    select count(0) from c_t_use_comment ctuc
	    left join c_t_use_userinfo ctuu on ctuu.userid=ctuc.userid
	    left join c_t_use_comment ctuc1 on ctuc.parentid=ctuc1.commentid
	    left join c_t_use_userinfo ctuu1 on ctuc1.userid=ctuu1.userid
	    <where>
	        <if test="orderid != null and orderid!= ''">and ctuc.resourceid=#{orderid}</if>
	        <if test="resourcetype !=null">and ctuc.resourcetype=#{resourcetype}</if>
	    </where>
	</select>
	
	<insert id="insertForword" parameterType="map">
	   	insert into c_t_use_forward_user
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="forwarduserid != null and forwarduserid != ''">forwarduserid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="resourceid != null and resourceid != ''">resourceid,</if>
	        <if test="receiveid != null and receiveid != ''">receiveid,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="resourcetype != null and resourcetype != ''">resourcetype,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	        issend,
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="forwarduserid != null and forwarduserid != ''">#{forwarduserid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="resourceid != null and resourceid != ''">#{resourceid},</if>
	        <if test="receiveid != null and receiveid != ''">#{receiveid},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="resourcetype != null and resourcetype != ''">#{resourcetype},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	        1,
	    </trim>
	</insert>
	<insert id="insertComment" parameterType="map">
	    insert into c_t_use_comment
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="commentid != null and commentid != ''">commentid,</if>
	        <if test="content != null and content != ''">content,</if>
	        <if test="userid != null and userid != ''">userid,</if>
	        <if test="resourceid != null and resourceid != ''">resourceid,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="parentid != null and parentid != ''">parentid,</if>
	        <if test="resourcetype != null and resourcetype != ''">resourcetype,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	        <if test="type != null and type != ''">type,</if>
	        <if test="forwardusernames != null and forwardusernames != ''">forwardusernames,</if>
	        <if test="forwarduserids != null and forwarduserids != ''">forwarduserids,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="commentid != null and commentid != ''">#{commentid},</if>
	        <if test="content != null and content != ''">#{content},</if>
	        <if test="userid != null and userid != ''">#{userid},</if>
	        <if test="resourceid != null and resourceid != ''">#{resourceid},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="parentid != null and parentid != ''">#{parentid},</if>
	        <if test="resourcetype != null and resourcetype != ''">#{resourcetype},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	        <if test="type != null and type != ''">#{type},</if>
	        <if test="forwardusernames != null and forwardusernames != ''">#{forwardusernames},</if>
	        <if test="forwarduserids != null and forwarduserids != ''">#{forwarduserids},</if>
	    </trim>
	</insert>
	<update id="updatePurchaseOrder" parameterType="map">
	    update c_t_use_purchase_order
	    <set>
	        <if test="opinion != null and opinion != ''">opinion=#{opinion},</if>
	        <if test="result != null">result=#{result},</if>
	        <if test="status != null">status=#{status},</if>
	        <if test="updatetime != null and updatetime != ''">updatetime=#{updatetime},</if>
	        <if test="updateid != null and updateid != ''">updateid=#{updateid},</if>
	    </set>
	    where orderid=#{orderid}
	</update>
	<update id="updateApplyOrder" parameterType="map">
	    update c_t_use_apply_order
	    <set>
	        <if test="opinion != null and opinion != ''">opinion=#{opinion},</if>
	        <if test="result != null">result=#{result},</if>
	        <if test="status != null">status=#{status},</if>
	        <if test="updatetime != null and updatetime != ''">updatetime=#{updatetime},</if>
	        <if test="updateid != null and updateid != ''">updateid=#{updateid},</if>
	    </set>
	    where orderid=#{orderid}
	</update>
	<select id="getApplyOrderList" parameterType="map" resultType="map">
	    select ctfu.isread,ctao.orderid,ctao.companyid,ctao.orderno,ctao.organizeid,ctao.examineuserid,ctao.createid,ctao.opinion,ctao.result,DATE_FORMAT(ctfu.createtime,'%Y-%m-%d %H:%i:%S') as createtime,DATE_FORMAT(ctao.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctao.updateid,ctao.status,
	    DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createdate,DATE_FORMAT(ctfu.createtime,'%H:%i') as createhour,ctao.materialprice,ctfu.forwarduserid,ctao.maternum,
	    ctuu.realname as createname,ctuu1.realname as examinename,ctuo.organizename
	    from c_t_use_apply_order ctao
	    right join c_t_use_forward_user ctfu on ctfu.resourceid=ctao.orderid and resourcetype=2
	    left join c_t_use_userinfo ctuu on ctao.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctao.examineuserid=ctuu1.userid
        left join c_t_use_organize ctuo on ctao.organizeid=ctuo.organizeid
	    <where>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctao.companyid=#{companyid}</if>
	        <if test="status != null">and ctao.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
	        and ctao.delflag=0 and ctfu.delflag=0
	    </where>
	    order by ctfu.createtime desc
	    <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
	</select>
	<select id="getApplyInfo" parameterType="map" resultType="map">
	    select ctao.orderid,ctao.companyid,ctao.orderno,ctao.organizeid,ctao.examineuserid,ctao.createid,ctao.opinion,ctao.result,DATE_FORMAT(ctao.createtime,'%Y-%m-%d %H:%i:%S') as createtime,DATE_FORMAT(ctao.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctao.updateid,ctao.status,
	    ctuu.realname as createname,ctuu1.realname as examinename,ctao.materialprice,ctuo.organizename,ctao.maternum,
	    ctuu.headimage as createheadimage,ctuu1.headimage as examineheadimage,ctao.CCuserids,IFNULL(ctao.CCusernames,"") as CCusernames
	    from c_t_use_apply_order ctao
	    left join c_t_use_userinfo ctuu on ctao.createid=ctuu.userid
	    left join c_t_use_userinfo ctuu1 on ctao.examineuserid=ctuu1.userid
	    left join c_t_use_organize ctuo on ctao.organizeid=ctuo.organizeid
	    <where>
	        <if test="orderid != null and orderid != ''">and ctao.orderid=#{orderid}</if>
	    </where>
	    limit 1
	</select>
	<select id="getApplyOrderListNum" parameterType="map" resultType="int">
	    select count(0) from c_t_use_apply_order ctao
	    right join c_t_use_forward_user ctfu on ctfu.resourceid=ctao.orderid and resourcetype=2
	    <where>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctao.companyid=#{companyid}</if>
	        <if test="status != null">and ctao.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
	        <if test="isread != null">and ctfu.isread=#{isread}</if>
	        and ctao.delflag=0 and ctfu.delflag=0
	    </where>
	</select>
	
	<insert id="insertApply" parameterType="map">
	    insert into c_t_use_apply_order
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="orderid != null and orderid != ''">orderid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="orderno != null and orderno != ''">orderno,</if>
	        <if test="organizeid != null and organizeid != ''">organizeid,</if>
	        <if test="examineuserid != null and examineuserid != ''">examineuserid,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="opinion != null and opinion != ''">opinion,</if>
	        <if test="result != null">result,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="status != null">status,</if>
	        <if test="materialprice != null">materialprice,</if>
	        <if test="maternum != null">maternum,</if> 
	        <if test="datacode != null and datacode != ''">datacode,</if>
	        <if test="delflag != null">delflag,</if>
	        <if test="CCuserids != null and CCuserids != ''">CCuserids,</if>
	        <if test="CCusernames != null and CCusernames != ''">CCusernames,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="orderid != null and orderid != ''">#{orderid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="orderno != null and orderno != ''">#{orderno},</if>
	        <if test="organizeid != null and organizeid != ''">#{organizeid},</if>
	        <if test="examineuserid != null and examineuserid != ''">#{examineuserid},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="opinion != null and opinion != ''">#{opinion},</if>
	        <if test="result != null">#{result},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="status != null">#{status},</if>
	        <if test="materialprice != null">#{materialprice},</if>
	        <if test="maternum != null">#{maternum},</if> 
	        <if test="datacode != null and datacode != ''">#{datacode},</if>
	        <if test="delflag != null">#{delflag},</if>
	        <if test="CCuserids != null and CCuserids != ''">#{CCuserids},</if>
	        <if test="CCusernames != null and CCusernames != ''">#{CCusernames},</if>
	    </trim>
	</insert>
	<insert id="insertApplyMaterial" parameterType="map">
	   	insert into c_t_use_apply_materiel
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="materielid != null and materielid != ''">materielid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="orderid != null and orderid != ''">orderid,</if>
	        <if test="type != null and type != ''">type,</if>
	        <if test="name != null and name != ''">name,</if>
	        <if test="specifications != null and specifications != ''">specifications,</if>
	        <if test="price != null">price,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="status != null">status,</if>
	        <if test="num != null">num,</if>
	        <if test="sumprice != null and sumprice != ''">sumprice,</if>
	        <if test="delflag != null">delflag,</if>
	        <if test="unit != null and unit != ''">unit,</if>
	        <if test="specificationsone != null and specificationsone != ''">specificationsone,</if>
	        <if test="specificationstwo != null and specificationstwo != ''">specificationstwo,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="materielid != null and materielid != ''">#{materielid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="orderid != null and orderid != ''">#{orderid},</if>
	        <if test="type != null and type != ''">#{type},</if>
	        <if test="name != null and name != ''">#{name},</if>
	        <if test="specifications != null and specifications != ''">#{specifications},</if>
	        <if test="price != null">#{price},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="status != null">#{status},</if>
	        <if test="num != null">#{num},</if>
	        <if test="sumprice != null and sumprice != ''">#{sumprice},</if>
	        <if test="delflag != null">#{delflag},</if>
	        <if test="unit != null and unit != ''">#{unit},</if>
	        <if test="specificationsone != null and specificationsone != ''">#{specificationsone},</if>
	        <if test="specificationstwo != null and specificationstwo != ''">#{specificationstwo},</if>
	    </trim>
	</insert>
	
	<select id="getApplyMaterialList" parameterType="map" resultType="map">
	    select ctuam.materielid,ctuam.companyid,ctuam.orderid,ctuam.type,ctuam.name,ifnull(ctuam.specifications,"") as specifications,ctuam.price,ctuam.num,ctuam.sumprice,DATE_FORMAT(ctuam.createtime,'%Y-%m-%d %H:%i:%S') as createtime,
	    DATE_FORMAT(ctuam.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctuam.updateid,ctuam.status,
	    ifnull(ctuam.unit,"") as unit,ifnull(ctmdd.cname,"") as specificationsone,ifnull(ctmdd1.cname,"") as specificationstwo,
	    concat(ifnull(ctuam.specifications,""),ifnull(ctmdd1.cname,""),ifnull(case ctmdd.cname when null then "" else CONCAT("/",ctmdd.cname) end,""))  AS specificationsall
	    from c_t_use_apply_materiel ctuam
	    left join c_t_manage_dict_data ctmdd on ctmdd.dataid=ctuam.specificationsone 
	    left join c_t_manage_dict_data ctmdd1 on ctmdd1.dataid=ctuam.specificationstwo
	    <where>
	        <if test="orderid !=null and orderid !=''">and ctuam.orderid=#{orderid}</if>
	        and ctuam.delflag=0
	    </where>
	</select>
	<select id="getMaterialDetail" parameterType="map" resultType="map">
	    select ctpm.materielid,ctpm.orderid,ctpm.type,ifnull(ctpm.price,0) as price,ifnull(ctpm.realprice,0) as realprice,ctpm.name,ifnull(ctpm.specifications,"") as specifications,ctpm.num,sum(ctpm.realnum) as realnum, sum(ctpm.sumprice) as sumprice,sum(ctpm.residualmoney) as residualmoney,ctpm.unit,
	    ifnull(ctmdd.cname,"") as specificationsone,ifnull(ctmdd1.cname,"") as specificationstwo,ctpm.stock,
	    concat(ifnull(ctpm.specifications,""),ifnull(ctmdd1.cname,""),ifnull(case ctmdd.cname when null then "" else CONCAT("/",ctmdd.cname) end,""))  AS specificationsall
	    from c_t_use_purchase_materiel ctpm
	    left join c_t_use_purchase_order ctpo on ctpm.orderid=ctpo.orderid
	    left join c_t_manage_dict_data ctmdd on ctmdd.dataid=ctpm.specificationsone 
	    left join c_t_manage_dict_data ctmdd1 on ctmdd1.dataid=ctpm.specificationstwo
	    <where>
	        <if test="starttime != null and starttime != ''">and ctpm.createtime &gt;#{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctpm.createtime &lt;#{endtime}</if>
	        <if test="type != null and type != ''">and ctpm.type=#{type}</if>
	        <if test="organizeid != null and organizeid != ''">and ctpo.organizeid=#{organizeid}</if>
	        <if test="maxstock != null">and ctpm.stock > 0</if>
	        and ctpo.result=1
	    </where>
	    group by ctpm.name,concat(ifnull(ctpm.specifications,""),ifnull(ctmdd1.cname,""),ifnull(case ctmdd.cname when null then "" else CONCAT("/",ctmdd.cname) end,"")),ctpm.price
	    order by ctpm.createtime desc
	    <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
	</select>
	<select id="getMaterialDetailNum" parameterType="map" resultType="int">
	    select count(0) from (select ctpm.materielid,ctpm.orderid,ctpm.type,ifnull(ctpm.price,0) as price,ifnull(ctpm.realprice,0) as realprice,ctpm.name,ifnull(ctpm.specifications,"") as specifications,ctpm.num,sum(ctpm.realnum) as realnum, sum(ctpm.sumprice) as sumprice,ctpm.unit,
	    ifnull(ctmdd.cname,"") as specificationsone,ifnull(ctmdd1.cname,"") as specificationstwo,ctpm.stock,
	    concat(ifnull(ctpm.specifications,""),ifnull(ctmdd1.cname,""),ifnull(case ctmdd.cname when null then "" else CONCAT("/",ctmdd.cname) end,""))  AS specificationsall
	    from c_t_use_purchase_materiel ctpm
	    left join c_t_use_purchase_order ctpo on ctpm.orderid=ctpo.orderid
	    left join c_t_manage_dict_data ctmdd on ctmdd.dataid=ctpm.specificationsone 
	    left join c_t_manage_dict_data ctmdd1 on ctmdd1.dataid=ctpm.specificationstwo
	    <where>
	        <if test="starttime != null and starttime != ''">and ctpm.createtime &gt;#{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctpm.createtime &lt;#{endtime}</if>
	        <if test="type != null and type != ''">and ctpm.type=#{type}</if>
	        <if test="organizeid != null and organizeid != ''">and ctpo.organizeid=#{organizeid}</if>
	        <if test="maxstock != null">and ctpm.stock > 0</if>
	        and ctpo.result=1
	    </where>
	    group by ctpm.name,concat(ifnull(ctpm.specifications,""),ifnull(ctmdd1.cname,""),ifnull(case ctmdd.cname when null then "" else CONCAT("/",ctmdd.cname) end,"")),ctpm.price
	    ) a
	</select>
	<select id="getPurchaseStatisticsList" parameterType="map" resultType="map">
	    select ctpo.orderid,ctpo.companyid,ctpo.orderno,ctpo.organizeid,ctpo.examineuserid,ctpo.createid,ctpo.opinion,ctpo.result,DATE_FORMAT(ctpo.createtime,'%Y-%m-%d %H:%i:%S') as createtime,DATE_FORMAT(ctpo.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctpo.updateid,ctpo.status
	    from c_t_use_purchase_materiel ctpm
	    left join c_t_use_purchase_order ctpo on ctpm.orderid=ctpo.orderid
	    <where>
	        <if test="starttime != null and starttime != ''">and ctpm.createtime &gt;#{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctpm.createtime &lt;#{endtime}</if>
	        <if test="type != null and type != ''">and ctpm.type=#{type}</if>
	        <if test="organizeid != null and organizeid != ''">and ctpo.organizeid=#{organizeid}</if>
	        <if test="companyid != null and companyid != ''">and ctpo.companyid=#{companyid}</if>
	        and ctpo.result=1
	    </where>
	    group by ctpo.orderid
	    order by ctpm.createtime desc
	    <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
	</select>
	<select id="getPurchaseStatisticsListNum" parameterType="map" resultType="int">
	    select count(0) from (select ctpo.orderid,ctpo.companyid,ctpo.orderno,ctpo.organizeid,ctpo.examineuserid,ctpo.createid,ctpo.opinion,ctpo.result,DATE_FORMAT(ctpo.createtime,'%Y-%m-%d %H:%i:%S') as createtime,DATE_FORMAT(ctpo.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctpo.updateid,ctpo.status
	    from c_t_use_purchase_materiel ctpm
	    left join c_t_use_purchase_order ctpo on ctpm.orderid=ctpo.orderid
	    <where>
	        <if test="starttime != null and starttime != ''">and ctpm.createtime &gt;#{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctpm.createtime &lt;#{endtime}</if>
	        <if test="type != null and type != ''">and ctpm.type=#{type}</if>
	        <if test="organizeid != null and organizeid != ''">and ctpo.organizeid=#{organizeid}</if>
	        <if test="companyid != null and companyid != ''">and ctpo.companyid=#{companyid}</if>
	        and ctpo.result=1
	    </where>
	    group by ctpo.orderid
	    ) a
	</select>
	<select id="getPurchaseNumByCompany" parameterType="map" resultType="int">
	    select count(0) from c_t_use_purchase_order
	    <where>
	        <if test="companyid != null and companyid != ''">and companyid=#{companyid}</if>
	        and to_days(createtime)=to_days(now())
	    </where>
	</select>
	<select id="getApplyNumByCompany" parameterType="map" resultType="int">
	    select count(0) from c_t_use_apply_order
	    <where>
	        <if test="companyid != null and companyid != ''">and companyid=#{companyid}</if>
	        and to_days(createtime)=to_days(now())
	    </where>
	</select>
	<update id="updateReturnOrder" parameterType="map">
	    update c_t_use_return_order
	    <set>
	        <if test="opinion != null and opinion != ''">opinion=#{opinion},</if>
	        <if test="result != null">result=#{result},</if>
	        <if test="status != null">status=#{status},</if>
	        <if test="updatetime != null and updatetime != ''">updatetime=#{updatetime},</if>
	        <if test="updateid != null and updateid != ''">updateid=#{updateid},</if>
	    </set>
	    where orderid=#{orderid}
	</update>
	
	<select id="getMaterialType" parameterType="map" resultType="map">
	    select ctpm.type as name,IFNULL(sum(ctpm.sumprice),0) as value from c_t_use_purchase_materiel ctpm
	    left join c_t_use_purchase_order ctpo on ctpm.orderid=ctpo.orderid
	    <where>
	        <if test="starttime != null and starttime != ''">and ctpm.createtime &gt;#{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctpm.createtime &lt;#{endtime}</if>
	        <if test="organizeid != null and organizeid != ''">and ctpo.organizeid=#{organizeid}</if>
	        and ctpo.result=1
	    </where>
	    group by ctpm.type
	    order by sum(ctpm.sumprice) desc
	</select>
	<select id="getPurchasePayAmount" parameterType="map" resultType="map">
	    select  ifnull(sum(ctpo.materialprice),0) as summaterialprice,ifnull(sum(ctpo.payamount),0) as sumpayamount
	    from c_t_use_purchase_order ctpo 
	    <where>
	        <if test="starttime != null and starttime != ''">and ctpo.createtime &gt;#{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctpo.createtime &lt;#{endtime}</if>
	        <if test="organizeid != null and organizeid != ''">and ctpo.organizeid=#{organizeid}</if>
	        and ctpo.result=1
	    </where>
	</select>
	<select id="getStockInfo" parameterType="map" resultType="map">
	    select ctpm.type as name,IFNULL(sum(ctpm.residualmoney),0) as value from c_t_use_purchase_materiel ctpm
	    left join c_t_use_purchase_order ctpo on ctpm.orderid=ctpo.orderid
	    <where>
	        <if test="organizeid != null and organizeid != ''">and ctpo.organizeid=#{organizeid}</if>
	        and ctpm.stock > 0 and ctpo.result=1
	    </where>
	    group by ctpm.type
	    order by sum(ctpm.price*ctpm.stock) desc
	</select>
	
	<select id="getStockPayAmountInfo" parameterType="map" resultType="map">
	    select
	    	sum(materialprice) as summaterialprice,sum(payamount) as sumpayamount
	    from (
		    select 
		    	ifnull(ctpo.materialprice,0) as materialprice,ifnull(ctpo.payamount,0) as payamount 
		    from c_t_use_purchase_materiel ctpm
		    left join c_t_use_purchase_order ctpo on ctpm.orderid=ctpo.orderid
		    <where>
		        <if test="organizeid != null and organizeid != ''">and ctpo.organizeid=#{organizeid}</if>
		        and ctpm.stock > 0 and ctpo.result=1
		    </where>
		    group by ctpm.orderid
	    ) TB
	</select>
	
	<!-- 查询新增申购单的采购类型 -->		
	<select id="getPurchaseTypeList" parameterType="map" resultType="map">
		select distinct type from c_t_use_purchase_materiel
		<where>
			<if test="companyid != null and companyid != ''">and companyid=#{companyid}</if>
		</where>
		order by createtime desc
	</select>
	<!-- 查询新增采购单的采购类型 -->		
	<select id="getApplyTypeList" parameterType="map" resultType="map">
		select distinct type from c_t_use_apply_materiel
		<where>
			<if test="companyid != null and companyid != ''">and companyid=#{companyid}</if>
		</where>
		order by createtime desc
	</select>	
	
	<select id="getUsername" parameterType="map" resultType="map">
		select realname from c_t_use_userinfo where userid=#{sendid}
	</select>
	
	<select id="getApplynameMaterialList" parameterType="map" resultType="map">
		select ctam.name,ctam.type from c_t_use_apply_materiel ctam inner join c_t_use_apply_order ctao on ctao.orderid=ctam.orderid
		where ctam.type=#{type} and ctam.companyid=#{companyid} and ctao.organizeid=#{organizeid} group by ctam.name order by ctam.createtime desc
	</select>
</mapper>