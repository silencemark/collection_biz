<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.collection.dao.oa.OfficeMapper">
    <insert id="insertCompanyModule" parameterType="map">
        insert into c_t_use_company_module
        <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="moduleid != null and moduleid != ''">moduleid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="modulename != null and modulename != ''">modulename,</if>
	        <if test="moduleimage != null and moduleimage != ''">moduleimage,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="moduleid != null and moduleid != ''">#{moduleid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="modulename != null and modulename != ''">#{modulename},</if>
	        <if test="moduleimage != null and moduleimage != ''">#{moduleimage},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	    </trim>
    </insert>
    <select id="getCompanyModuleList" parameterType="map" resultType="map">
        select moduleid,companyid,modulename,moduleimage,createid,DATE_FORMAT(createtime,'%Y-%m-%d %H:%i') as createtime,DATE_FORMAT(updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,updateid,status from c_t_use_company_module
        <where>
            <if test="companyid != null and companyid != ''">and companyid=#{companyid}</if>
            and delflag=0
        </where>
        order by createtime asc
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getCompanyModuleListCount" parameterType="map" resultType="int">
        select 
			count(*)
         from c_t_use_company_module
        <where>
            <if test="companyid != null and companyid != ''">and companyid=#{companyid}</if>
        </where>
    </select>
    <update id="updateCompanyModuleInfo" parameterType="map">
    	update c_t_use_company_module 
    	<set>
    		<if test="moduleimage != null and moduleimage != ''">moduleimage=#{moduleimage},</if>
    		<if test="modulename != null and modulename != ''">modulename=#{modulename},</if>
    		<if test="delflag != null">delflag=#{delflag},</if>
    	</set>
    	where moduleid=#{moduleid}
    </update>
    <insert id="insertBrief" parameterType="map">
        insert into c_t_use_module_brief
        <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="briefid != null and briefid != ''">briefid,</if>
	        <if test="moduleid != null and moduleid != ''">moduleid,</if>
	        <if test="title != null and title != ''">title,</if>
	        <if test="content != null and content != ''">content,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="briefid != null and briefid != ''">#{briefid},</if>
	        <if test="moduleid != null and moduleid != ''">#{moduleid},</if>
	        <if test="title != null and title != ''">#{title},</if>
	        <if test="content != null and content != ''">#{content},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	    </trim>
    </insert>
    <select id="getBriefList" parameterType="map" resultType="map">
        select  cturr.isread,ctumb.briefid,ctumb.moduleid,ctumb.title,ctumb.content,ctumb.createid,DATE_FORMAT(ctumb.createtime,'%Y-%m-%d %H:%i:%S') as createtime,ctumb.udpateid,DATE_FORMAT(ctumb.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime 
        from c_t_use_releaserange_user cturr 
		left join c_t_use_module_brief ctumb on cturr.resourceid=ctumb.briefid
		<where>
		    <if test="userid != null and userid != ''">and cturr.userid=#{userid}</if>
		    <if test="companyid != null and companyid != ''">and cturr.companyid=#{companyid}</if>
		    <if test="title != null and title != ''">and ctumb.title like concat("%",#{title},"%")</if>
		    <if test="moduleid != null and moduleid != ''">and ctumb.moduleid=#{moduleid}</if>
		    and cturr.resourcetype=7 and ctumb.delflag=0
		</where>
		group by ctumb.briefid
		order by cturr.createtime desc
		<if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getBriefListNum" parameterType="map" resultType="int">
        select count(0) from (select  cturr.isread,ctumb.briefid,ctumb.moduleid,ctumb.title,ctumb.content,ctumb.createid,DATE_FORMAT(ctumb.createtime,'%Y-%m-%d %H:%i:%S') as createtime,ctumb.udpateid,DATE_FORMAT(ctumb.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime 
        from c_t_use_releaserange_user cturr 
		left join c_t_use_module_brief ctumb on cturr.resourceid=ctumb.briefid
		<where>
		    <if test="userid != null and userid != ''">and cturr.userid=#{userid}</if>
		    <if test="companyid != null and companyid != ''">and cturr.companyid=#{companyid}</if>
		    <if test="title != null and title != ''">and ctumb.title like concat("%",#{title},"%")</if>
		    <if test="moduleid != null and moduleid != ''">and ctumb.moduleid=#{moduleid}</if>
		    and cturr.resourcetype=7 and ctumb.delflag=0
		</where>
		group by ctumb.briefid) a
    </select>
    <select id="getBriefInfo" parameterType="map" resultType="map">
        select ctumb.briefid,ctumb.moduleid,ctumb.title,ctumb.content,ctumb.createid,DATE_FORMAT(ctumb.createtime,'%Y-%m-%d %H:%i') as createtime,ctumb.udpateid, DATE_FORMAT(ctumb.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,
        ctuu.realname
        from c_t_use_module_brief ctumb
        left join c_t_use_userinfo ctuu on ctumb.createid=ctuu.userid
        <where>
            <if test="briefid != null and briefid != ''">and ctumb.briefid=#{briefid}</if>
        </where>
        limit 1
    </select>
    <update id="updateBriefInfo" parameterType="map">
    	update c_t_use_module_brief 
    	<set>
    		<if test="title != null and title != ''">title=#{title},</if>
    		<if test="content != null and content != ''">content=#{content},</if>
    		<if test="delflag != null">delflag=#{delflag},</if>
    	</set>
    	where briefid=#{briefid}
    </update>
    <select id="getSystemCloudList" parameterType="map" resultType="map">
        select fileid,filename,fileurl,memory,filetype,parentid,createid,DATE_FORMAT(createtime,'%Y-%m-%d %H:%i:%S') as createtime,updateid,DATE_FORMAT(updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,type,status 
        from c_t_manage_systemcloud_file
        <where>
            <if test="filename != null and filename != ''">and filename like concat("%",#{filename},"%")</if>
            <if test="isparentid != null ">and parentid is null</if>
            <if test="type != null ">and type=#{type}</if>
            <if test="filetype != null ">and filetype=#{filetype}</if>
            <if test="parentid != null">and parentid=#{parentid}</if>
            and delflag=0
        </where>
        order by filetype,createtime desc 
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getSystemCloudListNum" parameterType="map" resultType="int">
        select count(0) from c_t_manage_systemcloud_file
        <where>
            <if test="filename != null and filename != ''">and filename like concat("%",#{filename},"%")</if>
            <if test="isparentid != null ">and parentid is null</if>
            <if test="type != null ">and type=#{type}</if>
            <if test="filetype != null ">and filetype=#{filetype}</if>
            <if test="parentid != null">and parentid=#{parentid}</if>
            and delflag=0
        </where>
    </select>
    <insert id="insertCompanyCloudModule" parameterType="map">
        insert into c_t_use_companycloud_module
        <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="moduleid != null and moduleid != ''">moduleid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="modulename != null and modulename != ''">modulename,</if>
	        <if test="moduleimage != null and moduleimage != ''">moduleimage,</if>
	        <if test="createtime != null and createtime != ''">createtime,updatetime,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="moduleid != null and moduleid != ''">#{moduleid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="modulename != null and modulename != ''">#{modulename},</if>
	        <if test="moduleimage != null and moduleimage != ''">#{moduleimage},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},#{createtime},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	    </trim>
    </insert>
    <select id="getCompanyCloudModuleList" parameterType="map" resultType="map">
        select moduleid,companyid,modulename,moduleimage,createid,DATE_FORMAT(createtime,'%Y-%m-%d %H:%i:%S') as createtime,DATE_FORMAT(updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,updateid,status 
        from c_t_use_companycloud_module
        <where>
            <if test="companyid != null and companyid != ''">and companyid=#{companyid}</if>
            and delflag=0
        </where>
        order by createtime asc
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    
    <select id="getCompanyCloudModuleListCount" parameterType="map" resultType="int">
    	select 
    		count(*) 
        from c_t_use_companycloud_module
        <where>
            <if test="companyid != null and companyid != ''">and companyid=#{companyid}</if>
            and delflag=0
        </where>
    </select>
    
    <select id="getCompanyCloudList" parameterType="map" resultType="map">
        select 
	        ctmcf.fileid,ctmcf.cloudid,ctmcf.filename,ctmcf.fileurl,ctmcf.memory,ctmcf.filetype,ctmcf.parentid,ctmcf.createid,
	        DATE_FORMAT(ctmcf.createtime,'%Y-%m-%d %H:%i:%S') as createtime,ctmcf.updateid,DATE_FORMAT(ctmcf.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,
	        ctmcf.status,cturu.isread,ctmcf.title
        from  c_t_manage_cloud_file ctmcf
        left join  c_t_use_releaserange_user cturu on cturu.resourceid=ctmcf.fileid and cturu.resourcetype=13
        <where>
            <if test="title != null and title != ''">and ctmcf.title like concat("%",#{title},"%")</if>
            <if test="companyid != null and companyid != ''">and cturu.companyid=#{companyid}</if>
            <if test="userid != null and userid != ''">and cturu.userid=#{userid}</if>
            <if test="moduleid != null and moduleid != ''">and ctmcf.moduleid=#{moduleid}</if>
            <if test="parentid != null and parentid != ''">and ctmcf.parentid=#{parentid}</if>
            and ctmcf.delflag=0 and cturu.delflag=0
        </where>
        group by ctmcf.fileid
        order by ctmcf.createtime desc  
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getCompanyCloudListNum" parameterType="map" resultType="int">
        select count(0) 
		from (
			select 
		        ctmcf.fileid,ctmcf.cloudid,ctmcf.filename,ctmcf.fileurl,ctmcf.memory,ctmcf.filetype,ctmcf.parentid,ctmcf.createid,
		        DATE_FORMAT(ctmcf.createtime,'%Y-%m-%d %H:%i:%S') as createtime,ctmcf.updateid,DATE_FORMAT(ctmcf.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,
		        ctmcf.status,cturu.isread,ctmcf.title
	        from  c_t_manage_cloud_file ctmcf
	        left join  c_t_use_releaserange_user cturu on cturu.resourceid=ctmcf.fileid and cturu.resourcetype=13
	        <where>
	            <if test="title != null and title != ''">and ctmcf.title like concat("%",#{title},"%")</if>
	            <if test="companyid != null and companyid != ''">and cturu.companyid=#{companyid}</if>
	            <if test="userid != null and userid != ''">and cturu.userid=#{userid}</if>
	            <if test="moduleid != null and moduleid != ''">and ctmcf.moduleid=#{moduleid}</if>
            	<if test="parentid != null and parentid != ''">and ctmcf.parentid=#{parentid}</if>
	            and ctmcf.delflag=0 and cturu.delflag=0
	        </where>
	        group by ctmcf.fileid
		) a
    </select>
    <select id="getUserBirthdayList" parameterType="map" resultType="map">
        select ctuu.realname,ctuu.userid,ctuu.headimage,DATE_FORMAT(ctuu.birthday,'%c月%d日') as birthday,
        ctuu.position,co.organizename,date_format(ctuu.birthday,'%d') as bday,date_format(ctuu.birthday,'%m') as bmonth
        from c_t_use_userinfo ctuu
        left join c_t_use_organize_userinfo cou on cou.userid=ctuu.userid
        left join c_t_use_organize co on co.organizeid=cou.organizeid
        <where>
            <if test="monthnum != null ">and DATE_FORMAT(ctuu.birthday,'%c')=#{monthnum}</if>
            <if test="companyid != null and companyid != ''">and ctuu.companyid=#{companyid}</if>
               <if test="starttime != null and starttime != ''">and ctuu.birthday &gt; #{starttime}</if>
            <if test="endtime != null and endtime != ''">and ctuu.birthday &lt; #{endtime}</if>
            and ctuu.delflag=0 and cou.delflag = 0
        </where>
        order by ctuu.birthday,ctuu.createtime
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getUserBirthdayListNum" parameterType="map" resultType="int">
        select count(0) from c_t_use_userinfo ctuu
        <where>
            <if test="monthnum != null ">and DATE_FORMAT(ctuu.birthday,'%c')=#{monthnum}</if>
            <if test="companyid != null and companyid != ''">and ctuu.companyid=#{companyid}</if>
              <if test="starttime != null and starttime != ''">and ctuu.birthday &gt; #{starttime}</if>
            <if test="endtime != null and endtime != ''">and ctuu.birthday &lt; #{endtime}</if>
            and ctuu.delflag=0
        </where>
    </select>
    <select id="getUserRewardList" parameterType="map" resultType="map">
        select 
        	cturo.rewardid,ctuu.headimage,ctuu.realname,DATE_FORMAT(cturo.createtime,'%Y-%m-%d %H:%i') as createtime,
        	ifnull(cturo.resulttext,ctmdd.cname) as rewardresult,ctuu.headimage
        from c_t_use_reward_order cturo
        left join c_t_use_userinfo ctuu on cturo.rewarduserid=ctuu.userid
        left join c_t_manage_dict_data ctmdd on cturo.rewardresult=ctmdd.dataid
        <where>
            <if test="companyid != null and companyid != ''">and cturo.companyid=#{companyid}</if>
            <if test="starttime != null and starttime != ''">and cturo.createtime &gt;=concat(#{starttime}," 00:00:00") </if>
            <if test="endtime != null and endtime != ''">and cturo.createtime &lt;=concat(#{endtime}," 23:59:59") </if>
            and cturo.delflag=0 and cturo.result=1
        </where>
        order by cturo.createtime desc
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getUserRewardListNum" parameterType="map" resultType="int">
        select count(0) from c_t_use_reward_order cturo
        left join c_t_use_userinfo ctuu on cturo.rewarduserid=ctuu.userid
        left join c_t_manage_dict_data ctmdd on cturo.rewardresult=ctmdd.dataid
        <where>
            <if test="companyid != null and companyid != ''">and cturo.companyid=#{companyid}</if>
            <if test="starttime != null and starttime != ''">and cturo.createtime &gt; #{starttime}</if>
            <if test="endtime != null and endtime != ''">and cturo.createtime &lt; #{endtime}</if>
            and ctuu.delflag=0 and cturo.result=1
        </where>
    </select>
    <insert id="insertReserveAmount" parameterType="map">
        insert into c_t_use_reserveamount
        <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="reserveamountid != null and reserveamountid != ''">reserveamountid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="reason != null and reason != ''">reason,</if>
	        <if test="urgentlevel != null and urgentlevel != ''">urgentlevel,</if>
	        <if test="amount != null">amount,</if>
	        <if test="usetime != null and usetime != ''">usetime,</if>
	        <if test="returntime != null and returntime != ''">returntime,</if>
	        <if test="remark != null and remark != ''">remark,</if>
	        <if test="examineuserid != null and examineuserid != ''">examineuserid,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	        <if test="CCuserids != null and CCuserids != ''">CCuserids,</if>
	        <if test="CCusernames != null and CCusernames != ''">CCusernames,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="reserveamountid != null and reserveamountid != ''">#{reserveamountid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="reason != null and reason != ''">#{reason},</if>
	        <if test="urgentlevel != null and urgentlevel != ''">#{urgentlevel},</if>
	        <if test="amount != null">#{amount},</if>
	        <if test="usetime != null and usetime != ''">#{usetime},</if>
	        <if test="returntime != null and returntime != ''">#{returntime},</if>
	        <if test="remark != null and remark != ''">#{remark},</if>
	        <if test="examineuserid != null and examineuserid != ''">#{examineuserid},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	        <if test="CCuserids != null and CCuserids != ''">#{CCuserids},</if>
	        <if test="CCusernames != null and CCusernames != ''">#{CCusernames},</if>
	    </trim>
    </insert>
    <select id="getReserveAmountList" parameterType="map" resultType="map">
        select ctfu.isread,ctur.reserveamountid,ctur.companyid,ctur.amount,ctur.usetime,ctur.returntime,ctur.remark,ctur.reason,ctur.urgentlevel,
        ctur.examineuserid,ctur.createid,ctur.opinion,ctur.result,DATE_FORMAT(ctfu.createtime,'%Y-%m-%d %H:%i') as createtime,DATE_FORMAT(ctur.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctur.updateid,ctur.status,
	    DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createdate,DATE_FORMAT(ctfu.createtime,'%H:%i') as createhour,ctfu.forwarduserid,
	    ctuu.realname as createname,ctuu1.realname as examinename,
	    ctuu.headimage as creatheadimage,ctuu1.headimage as examineheadimage
	    from c_t_use_reserveamount ctur
	    left join c_t_use_forward_user ctfu on ctfu.resourceid=ctur.reserveamountid and resourcetype=20
	    left join c_t_use_userinfo ctuu on ctur.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctur.examineuserid=ctuu1.userid
	    <where>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctur.companyid=#{companyid}</if>
	        <if test="status != null">and ctur.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
            <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
	        and ctur.delflag=0 and ctfu.delflag=0
	    </where>
	    order by ctfu.createtime desc
	    <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getReserveAmountListNum" parameterType="map" resultType="int">
        select count(0) from c_t_use_reserveamount ctur
	    left join c_t_use_forward_user ctfu on ctfu.resourceid=ctur.reserveamountid and resourcetype=20
	    <where>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctur.companyid=#{companyid}</if>
	        <if test="status != null">and ctur.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
            <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
            <if test="isread != null">and ctfu.isread=#{isread}</if>
	        and ctur.delflag=0 and ctfu.delflag=0
	    </where>
    </select>
    <select id="getReserveAmountInfo" parameterType="map" resultType="map">
        select ctur.reserveamountid,ctur.companyid,ctur.amount,DATE_FORMAT(ctur.usetime,'%Y-%m-%d %H:%i') as usetime,DATE_FORMAT(ctur.returntime,'%Y-%m-%d %H:%i')  as returntime,ctur.remark,ctur.reason,ctur.urgentlevel,
        ctur.examineuserid,ctur.createid,ctur.opinion,ctur.result,DATE_FORMAT(ctur.createtime,'%Y-%m-%d %H:%i:%S') as createtime,DATE_FORMAT(ctur.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctur.updateid,ctur.status,
        ctuu.realname as createname,ctuu1.realname as examinename,ctuu.phone as createphone,
   		ctuu.headimage as createheadimage,ctuu1.headimage as examineheadimage,ctuu1.phone as examinephone,ctur.CCuserids,IFNULL(ctur.CCusernames,"") as CCusernames     
	    from c_t_use_reserveamount ctur
	    left join c_t_use_userinfo ctuu on ctur.createid=ctuu.userid
	    left join c_t_use_userinfo ctuu1 on ctur.examineuserid=ctuu1.userid
	    <where>
	        <if test="reserveamountid != null and reserveamountid != ''">and ctur.reserveamountid=#{reserveamountid}</if>
	    </where>
	    limit 1
    </select>
    <update id="updateReserveAmount" parameterType="map">
        update c_t_use_reserveamount
        <set>
	        <if test="opinion != null and opinion != ''">opinion=#{opinion},</if>
	        <if test="result != null">result=#{result},</if>
	        <if test="status != null">status=#{status},</if>
	        <if test="updatetime != null and updatetime != ''">updatetime=#{updatetime},</if>
	        <if test="updateid != null and updateid != ''">updateid=#{updateid},</if>
	    </set>
	    where reserveamountid=#{reserveamountid}
    </update>
    <insert id="insertTask" parameterType="map">
        insert into c_t_use_task
        <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="taskid != null and taskid != ''">taskid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="title != null and title != ''">title,</if>
	        <if test="content != null and content != ''">content,</if>
	        <if test="endtime != null and endtime != ''">endtime,</if>
	        <if test="examineuserid != null and examineuserid != ''">examineuserid,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="taskid != null and taskid != ''">#{taskid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="title != null and title != ''">#{title},</if>
	        <if test="content != null and content != ''">#{content},</if>
	        <if test="endtime != null and endtime != ''">#{endtime},</if>
	        <if test="examineuserid != null and examineuserid != ''">#{examineuserid},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	    </trim>
    </insert>
    <insert id="insertTaskAssist" parameterType="map">
        insert into c_t_use_task_assist
        <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="assistid != null and assistid != ''">assistid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="taskid != null and taskid != ''">taskid,</if>
	        <if test="assistuserid != null and assistuserid != ''">assistuserid,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="assistid != null and assistid != ''">#{assistid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="taskid != null and taskid != ''">#{taskid},</if>
	        <if test="assistuserid != null and assistuserid != ''">#{assistuserid},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	    </trim>
    </insert>
    <select id="getTaskList" parameterType="map" resultType="map">
        select ctfu.isread,DATE_FORMAT(ctfu.createtime,'%Y-%m-%d %H:%i:%S') as createtime,ctut.taskid,ctut.companyid,ctut.title,ctut.content,
        DATE_FORMAT(ctut.endtime,'%Y-%m-%d %H:%i:%S') as endtime,ctut.status,ctut.examineuserid,ctut.opinion,ctut.createid,
        DATE_FORMAT(ctut.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctut.updateid,
	    DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createdate,DATE_FORMAT(ctfu.createtime,'%H:%i') as createhour,ctfu.forwarduserid,
	    ctuu.realname as createname,ctuu1.realname as examinename
	    from c_t_use_task ctut
	    left join c_t_use_forward_user ctfu on ctfu.resourceid=ctut.taskid and resourcetype=19
	    left join c_t_use_userinfo ctuu on ctut.createid=ctuu.userid
	    left join c_t_use_userinfo ctuu1 on ctut.examineuserid=ctuu1.userid
	    <where>
	        <if test="keyword != null and keyword != ''">and (ctut.title like concat("%",#{keyword},"%") or ctut.content like concat("%",#{keyword},"%"))</if>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctut.companyid=#{companyid}</if>
	        <if test="status != null">and ctut.status=#{status}</if>
	        <if test="isoverdue != null">and ctut.endtime &lt; now()</if>
	        <if test="nooverdue != null">and ctut.endtime &gt; now()</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; concat(#{starttime}," 00:00:00")</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; concat(#{endtime}," 23:59:59")</if>
	        and ctut.delflag=0 and ctfu.delflag=0
	    </where>
	    order by ctfu.createtime desc
	    <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getTaskListNum" parameterType="map" resultType="int">
        select count(0) from c_t_use_task ctut
	    left join c_t_use_forward_user ctfu on ctfu.resourceid=ctut.taskid and resourcetype=19
	    left join c_t_use_userinfo ctuu on ctut.createid=ctuu.userid
	    left join c_t_use_userinfo ctuu1 on ctut.examineuserid=ctuu1.userid
	    <where>
	        <if test="keyword != null and keyword != ''">and (ctut.title like concat("%",#{keyword},"%") or ctut.content like concat("%",#{keyword},"%"))</if>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctut.companyid=#{companyid}</if>
	        <if test="status != null">and ctut.status=#{status}</if>
	        <if test="isoverdue != null">and ctut.endtime &lt; now()</if>
	        <if test="nooverdue != null">and ctut.endtime &gt; now()</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; concat(#{starttime}," 00:00:00")</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; concat(#{endtime}," 23:59:59")</if>
	        <if test="isread != null">and ctfu.isread=#{isread}</if>
	        and ctut.delflag=0 and ctfu.delflag=0
	    </where>
    </select>
    <select id="getTaskAssisList" parameterType="map" resultType="map">
        select ctuu.userid,ctuu.realname,ctuu.headimage from c_t_use_task_assist ctuta
        left join c_t_use_userinfo ctuu on ctuta.assistuserid=ctuu.userid
        <where>
            <if test="taskid != null and taskid != ''">and taskid=#{taskid}</if>
        </where>
    </select>
    
    <!-- 查询任务的时间列表信息 -->
    <select id="getTaskTimeList" parameterType="map" resultType="map">
    	select 
	    	distinct DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createtime
	    from c_t_use_task ctut
	    left join c_t_use_forward_user ctfu on ctfu.resourceid=ctut.taskid and resourcetype=19
	    left join c_t_use_userinfo ctuu on ctut.createid=ctuu.userid
	    left join c_t_use_userinfo ctuu1 on ctut.examineuserid=ctuu1.userid
	    <where>
	        <if test="keyword != null and keyword != ''">and (ctut.title like concat("%",#{keyword},"%") or ctut.content like concat("%",#{keyword},"%"))</if>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctut.companyid=#{companyid}</if>
	        <if test="status != null">and ctut.status=#{status}</if>
	        <if test="isoverdue != null">and ctut.endtime &lt; now()</if>
	        <if test="nooverdue != null">and ctut.endtime &gt; now()</if>
	        and ctut.delflag=0 and ctfu.delflag=0
	    </where>
	    order by ctfu.createtime desc
	    <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    
    <!-- 查询任务时间列表信息 -->
    <select id="getTaskTimsListCount" parameterType="map" resultType="int">
    	select
    		count(*)
    	from (
    		select 
		    	distinct DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createtime
		    from c_t_use_task ctut
		    left join c_t_use_forward_user ctfu on ctfu.resourceid=ctut.taskid and resourcetype=19
		    left join c_t_use_userinfo ctuu on ctut.createid=ctuu.userid
		    left join c_t_use_userinfo ctuu1 on ctut.examineuserid=ctuu1.userid
		    <where>
		        <if test="keyword != null and keyword != ''">and (ctut.title like concat("%",#{keyword},"%") or ctut.content like concat("%",#{keyword},"%"))</if>
		        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
		        <if test="companyid != null and companyid != ''">and ctut.companyid=#{companyid}</if>
		        <if test="status != null">and ctut.status=#{status}</if>
		        <if test="isoverdue != null">and ctut.endtime &lt; now()</if>
		        <if test="nooverdue != null">and ctut.endtime &gt; now()</if>
		        <if test="isread != null">and ctfu.isread=#{isread}</if>
		        and ctut.delflag=0 and ctfu.delflag=0
		    </where>
    	) task
    </select>
    
    <select id="getTaskInfo" parameterType="map" resultType="map">
        select ctut.taskid,ctut.companyid,ctut.title,ctut.content,DATE_FORMAT(ctut.endtime,'%Y-%m-%d %H:%i:%S') as endtime,ctut.status,ctut.examineuserid,ctut.opinion,ctut.createid,DATE_FORMAT(ctut.createtime,'%Y-%m-%d %H:%i:%S') as createtime,
        ctuu.realname as createname,ctuu1.realname as examinename,
       	ctuu.headimage as createheadimage,ctuu1.headimage as examineheadimage
      	from c_t_use_task ctut 
      	left join c_t_use_userinfo ctuu on  ctut.createid=ctuu.userid
      	left join c_t_use_userinfo ctuu1 on ctut.examineuserid=ctuu1.userid
      	<where>
      	    <if test="taskid != null and taskid != ''">and taskid=#{taskid}</if>
      	</where>
      	limit 1
    </select>
    <update id="updateTask" parameterType="map">
        update c_t_use_task
        <set>
            <if test="updatetime !=null and updatetime != ''">updatetime=#{updatetime},</if>
            <if test="updateid !=null and updateid != ''">updateid=#{updateid},</if>
            <if test="delflag != null">delflag=#{delflag},</if>
            <if test="opinion != null and opinion != ''">opinion=#{opinion},</if>
            <if test="status != null">status=#{status},</if>
        </set>
        where taskid=#{taskid}
    </update>
    
    <insert id="insertLeave" parameterType="map">
        insert into c_t_use_leave
        <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="leaveid != null and leaveid != ''">leaveid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="leavetype != null and leavetype != ''">leavetype,</if>
	        <if test="starttime != null and starttime != ''">starttime,</if>
	        <if test="endtime != null and endtime != ''">endtime,</if>
	        <if test="daynum !=null">daynum,</if>
	        <if test="hournum !=null">hournum,</if>
	        <if test="reason != null and reason != ''">reason,</if>
	        <if test="examineuserid != null and examineuserid != ''">examineuserid,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	        <if test="CCuserids != null and CCuserids != ''">CCuserids,</if>
	        <if test="CCusernames != null and CCusernames != ''">CCusernames,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="leaveid != null and leaveid != ''">#{leaveid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="leavetype != null and leavetype != ''">#{leavetype},</if>
	        <if test="starttime != null and starttime != ''">#{starttime},</if>
	        <if test="endtime != null and endtime != ''">#{endtime},</if>
	        <if test="daynum !=null">#{daynum},</if>
	        <if test="hournum !=null">#{hournum},</if>
	        <if test="reason != null and reason != ''">#{reason},</if>
	        <if test="examineuserid != null and examineuserid != ''">#{examineuserid},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	        <if test="CCuserids != null and CCuserids != ''">#{CCuserids},</if>
	        <if test="CCusernames != null and CCusernames != ''">#{CCusernames},</if>
	    </trim>
    </insert>
    <select id="getLeaveList" parameterType="map" resultType="map">
        select ctfu.isread,ctfu.forwarduserid,ctul.leaveid,ctul.companyid,ctul.leavetype,DATE_FORMAT(ctul.starttime,'%Y-%m-%d %H:%i') as starttime,
        DATE_FORMAT(ctul.endtime,'%Y-%m-%d %H:%i') as endtime,ctul.daynum,ctul.hournum,ctul.reason,ctul.result,ctul.examineuserid,
        DATE_FORMAT(ctul.updatetime,'%Y-%m-%d %H:%i') as updatetime,ctul.updateid,ctul.status,ctul.opinion,ctul.createid,
        DATE_FORMAT(ctfu.createtime,'%Y-%m-%d %H:%i') as createtime,
        ctmdd.cname as leavetypename,ctuu.realname as createname,ctuu.headimage AS createheadimage,
        ctuu1.realname as examinename,ctuu1.headimage AS examineheadimage
        from c_t_use_leave ctul 
        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctul.leaveid and resourcetype=18
        left join c_t_manage_dict_data ctmdd on ctul.leavetype=ctmdd.dataid
        left join c_t_use_userinfo ctuu on ctul.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctul.examineuserid=ctuu1.userid
        <where>
            <if test="companyid != null and companyid !=''">and ctul.companyid=#{companyid}</if>
            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="status != null">and ctul.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; concat(#{starttime}," 00:00:00")</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; concat(#{endtime}," 23:59:59")</if>
            and ctul.delflag=0 and ctfu.delflag=0
        </where>
        order by ctul.createtime desc
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getLeaveListNum" parameterType="map" resultType="int">
        select count(0) from c_t_use_leave ctul 
        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctul.leaveid and resourcetype=18
        left join c_t_manage_dict_data ctmdd on ctul.leavetype=ctmdd.dataid
        left join c_t_use_userinfo ctuu on ctul.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctul.examineuserid=ctuu1.userid
        <where>
            <if test="companyid != null and companyid !=''">and ctul.companyid=#{companyid}</if>
            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="status != null">and ctul.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; concat(#{starttime}," 00:00:00")</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; concat(#{endtime}," 23:59:59")</if>
	        <if test="isread != null">and ctfu.isread=#{isread}</if>
            and ctul.delflag=0 and ctfu.delflag=0
        </where>
    </select>
    
    <!-- 查询请假事假列表信息 -->
    <select id="getLeaveTimesList" parameterType="map" resultType="map">
    	select 
        	distinct DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') as createtime
        from c_t_use_leave ctul 
        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctul.leaveid and resourcetype=18
        left join c_t_manage_dict_data ctmdd on ctul.leavetype=ctmdd.dataid
        left join c_t_use_userinfo ctuu on ctul.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctul.examineuserid=ctuu1.userid
        <where>
            <if test="companyid != null and companyid !=''">and ctul.companyid=#{companyid}</if>
            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="status != null">and ctul.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; concat(#{starttime}," 00:00:00")</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; concat(#{endtime}," 23:59:59")</if>
            and ctul.delflag=0 and ctfu.delflag=0
        </where>
        order by ctul.createtime desc
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    
    <!-- 查询请假时间列表信息的总数 -->
    <select id="getLeaveTimesCount" parameterType="map" resultType="int">
    	select count(*) 
    	from(
    		select 
	        	distinct DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') as createtime
	        from c_t_use_leave ctul 
	        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctul.leaveid and resourcetype=18
	        left join c_t_manage_dict_data ctmdd on ctul.leavetype=ctmdd.dataid
	        left join c_t_use_userinfo ctuu on ctul.createid=ctuu.userid
	        left join c_t_use_userinfo ctuu1 on ctul.examineuserid=ctuu1.userid
	        <where>
	            <if test="companyid != null and companyid !=''">and ctul.companyid=#{companyid}</if>
	            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
		        <if test="status != null">and ctul.status=#{status}</if>
		        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; concat(#{starttime}," 00:00:00")</if>
		        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; concat(#{endtime}," 23:59:59")</if>
		        <if test="isread != null">and ctfu.isread=#{isread}</if>
	            and ctul.delflag=0 and ctfu.delflag=0
	        </where>
    	) lve
    </select>
    
    <select id="getLeaveInfo" parameterType="map" resultType="map">
        select ctul.leaveid,ctul.companyid,ctul.leavetype,DATE_FORMAT(ctul.starttime,'%Y-%m-%d %H:%i') as starttime,
        DATE_FORMAT(ctul.endtime,'%Y-%m-%d %H:%i') as endtime,ctul.daynum,ctul.hournum,ctul.reason,ctul.result,ctul.examineuserid,
        DATE_FORMAT(ctul.updatetime,'%Y-%m-%d %H:%i') as updatetime,ctul.updateid,ctul.status,ctul.opinion,ctul.createid,
        DATE_FORMAT(ctul.createtime,'%Y-%m-%d %H:%i') as createtime,
        ctmdd.cname as leavetypename,ctuu.realname as createname,ctuu.headimage AS createheadimage,
        ctuu1.realname as examinename,ctuu1.headimage AS examineheadimage,ctul.CCuserids,IFNULL(ctul.CCusernames,"") as CCusernames
        from c_t_use_leave ctul 
        left join c_t_manage_dict_data ctmdd on ctul.leavetype=ctmdd.dataid
        left join c_t_use_userinfo ctuu on ctul.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctul.examineuserid=ctuu1.userid
        <where>
            <if test="leaveid != null and leaveid != ''">and ctul.leaveid=#{leaveid}</if>
        </where>
        limit 1
    </select>
    <update id="updateLeave" parameterType="map">
        update c_t_use_leave
        <set>
            <if test="updatetime !=null and updatetime != ''">updatetime=#{updatetime},</if>
            <if test="updateid !=null and updateid != ''">updateid=#{updateid},</if>
            <if test="delflag != null">delflag=#{delflag},</if>
            <if test="opinion != null and opinion != ''">opinion=#{opinion},</if>
            <if test="result != null">result=#{result},</if>
            <if test="status != null">status=#{status},</if>
        </set>
        where leaveid=#{leaveid}
    </update>
    <select id="getExpenseNumByCompany" parameterType="map" resultType="int">
        select count(0) from c_t_use_expense
	    <where>
	        <if test="companyid != null and companyid != ''">and companyid=#{companyid}</if>
	        and to_days(createtime)=to_days(now())
	    </where>
	</select>
    <insert id="insertExpense" parameterType="map" >
        insert into c_t_use_expense
        <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="expenseid != null and expenseid != ''">expenseid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="expenseno != null and expenseno != ''">expenseno,</if>
	        <if test="examineuserid != null and examineuserid != ''">examineuserid,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	        <if test="detailprice != null">detailprice,</if>
	        <if test="detailnum != null">detailnum,</if>
	        <if test="CCuserids != null and CCuserids != ''">CCuserids,</if>
	        <if test="CCusernames != null and CCusernames != ''">CCusernames,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="expenseid != null and expenseid != ''">#{expenseid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="expenseno != null and expenseno != ''">#{expenseno},</if>
	        <if test="examineuserid != null and examineuserid != ''">#{examineuserid},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	        <if test="detailprice != null">#{detailprice},</if>
	        <if test="detailnum != null">#{detailnum},</if>
	        <if test="CCuserids != null and CCuserids != ''">#{CCuserids},</if>
	        <if test="CCusernames != null and CCusernames != ''">#{CCusernames},</if>
	    </trim>
    </insert>
    <insert id="insertExpenseDetail" parameterType="map">
        insert into c_t_use_expense_detail
        <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="expensedetailid != null and expensedetailid != ''">expensedetailid,</if>
	        <if test="expenseid != null and expenseid != ''">expenseid,</if>
	        <if test="type != null and type != ''">type,</if>
	        <if test="price != null and price != ''">price,</if>
	        <if test="detail != null and detail != ''">detail,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="expensedetailid != null and expensedetailid != ''">#{expensedetailid},</if>
	        <if test="expenseid != null and expenseid != ''">#{expenseid},</if>
	        <if test="type != null and type != ''">#{type},</if>
	        <if test="price != null and price != ''">#{price},</if>
	        <if test="detail != null and detail != ''">#{detail},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	    </trim>
    </insert>
    <select id="getExpenseList" parameterType="map" resultType="map">
        select ctfu.isread,ctfu.forwarduserid,ctue.expenseid,ctue.companyid,ctue.expenseno,ctue.result,ctue.examineuserid,
        DATE_FORMAT(ctue.updatetime,'%Y-%m-%d %H:%i') as updatetime,ctue.updateid,ctue.status,
        ctue.opinion,ctue.createid,DATE_FORMAT(ctue.createtime,'%Y-%m-%d %H:%i') as createtime,
        ctuu.realname as createname,ctuu1.realname as examinename,
        ctue.detailprice,ctue.detailnum
        from c_t_use_expense ctue
        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctue.expenseid and resourcetype=17
        left join c_t_use_userinfo ctuu on ctue.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctue.examineuserid=ctuu1.userid
        <where>
            <if test="companyid != null and companyid !=''">and ctue.companyid=#{companyid}</if>
            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="status != null">and ctue.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt;=concat(#{starttime}," 00:00:00") </if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt;= concat(#{endtime}," 23:59:59")</if>
            and ctue.delflag=0 and ctfu.delflag=0
        </where>
        order by ctue.createtime desc
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getExpenseListNum" parameterType="map" resultType="int">
        select count(0) from c_t_use_expense ctue
        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctue.expenseid and resourcetype=17
        left join c_t_use_userinfo ctuu on ctue.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctue.examineuserid=ctuu1.userid
        <where>
            <if test="companyid != null and companyid !=''">and ctue.companyid=#{companyid}</if>
            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="status != null">and ctue.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt;=concat(#{starttime}," 00:00:00") </if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt;= concat(#{endtime}," 23:59:59")</if>
	        <if test="isread != null">and ctfu.isread=#{isread}</if>
            and ctue.delflag=0 and ctfu.delflag=0
        </where>
    </select>
    
    <!-- 查询报销单的时间列表信息 -->
    <select id="getExpenseTimesList" parameterType="map" resultType="map">
    	select 
        	DISTINCT DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') as createtime
        from c_t_use_expense ctue
        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctue.expenseid and resourcetype=17
        left join c_t_use_userinfo ctuu on ctue.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctue.examineuserid=ctuu1.userid
        <where>
            <if test="companyid != null and companyid !=''">and ctue.companyid=#{companyid}</if>
            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="status != null">and ctue.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt;=concat(#{starttime}," 00:00:00") </if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt;= concat(#{endtime}," 23:59:59")</if>
            and ctue.delflag=0 and ctfu.delflag=0
        </where>
        order by ctue.createtime desc
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    
    <!--  -->
    <select id="getExpenseTimesListCount" parameterType="map" resultType="int">
    	select count(*) 
    	from (
    		select 
	        	DISTINCT DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') as createtime
	        from c_t_use_expense ctue
	        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctue.expenseid and resourcetype=17
	        left join c_t_use_userinfo ctuu on ctue.createid=ctuu.userid
	        left join c_t_use_userinfo ctuu1 on ctue.examineuserid=ctuu1.userid
	        <where>
	            <if test="companyid != null and companyid !=''">and ctue.companyid=#{companyid}</if>
	            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
		        <if test="status != null">and ctue.status=#{status}</if>
		        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt;=concat(#{starttime}," 00:00:00") </if>
		        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt;= concat(#{endtime}," 23:59:59")</if>
		        <if test="isread != null">and ctfu.isread=#{isread}</if>
	            and ctue.delflag=0 and ctfu.delflag=0
	        </where>
    	) ex
    </select>
    
    <select id="getExpenseInfo" parameterType="map" resultType="map">
        select ctue.expenseid,ctue.companyid,ctue.expenseno,ctue.result,ctue.examineuserid,
        DATE_FORMAT(ctue.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctue.updateid,ctue.status,ctue.opinion,ctue.createid,DATE_FORMAT(ctue.createtime,'%Y-%m-%d %H:%i:%S') as createtime,
        ctuu.realname as createname,ctuu1.realname as examinename,
		ctuu.headimage as createheadimage,ctuu1.headimage as examineheadimage,
        ctue.detailprice,ctue.detailnum,ctue.CCuserids,IFNULL(ctue.CCusernames,"") as CCusernames
        from c_t_use_expense ctue
        left join c_t_use_userinfo ctuu on ctue.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctue.examineuserid=ctuu1.userid
        <where>
            <if test="expenseid != null and expenseid !=''">and ctue.expenseid=#{expenseid}</if>
        </where>
        limit 1
    </select>
    <select id="getExpenseDetailList" parameterType="map" resultType="map">
        select expensedetailid,expenseid,type,price,detail,createid,createtime,updatetime,updateid,status from c_t_use_expense_detail
        <where>
            <if test="expenseid != null and expenseid != ''">and expenseid=#{expenseid}</if>
            and delflag=0
        </where>
    </select>
    <update id="updateExpense" parameterType="map">
        update c_t_use_expense
        <set>
            <if test="updatetime !=null and updatetime != ''">updatetime=#{updatetime},</if>
            <if test="updateid !=null and updateid != ''">updateid=#{updateid},</if>
            <if test="delflag != null">delflag=#{delflag},</if>
            <if test="opinion != null and opinion != ''">opinion=#{opinion},</if>
            <if test="result != null">result=#{result},</if>
            <if test="status != null">status=#{status},</if>
        </set>
        where expenseid=#{expenseid}
    </update>
    <insert id="insertRequest" parameterType="map">
        insert into c_t_use_request
        <trim prefix="(" suffix=")" suffixOverrides=",">
	        <if test="requestid != null and requestid != ''">requestid,</if>
	        <if test="companyid != null and companyid != ''">companyid,</if>
	        <if test="reason != null and reason != ''">reason,</if>
	        <if test="content != null and content != ''">content,</if>
	        <if test="examineuserid != null and examineuserid != ''">examineuserid,</if>
	        <if test="createtime != null and createtime != ''">createtime,</if>
	        <if test="createid != null and createid != ''">createid,</if>
	        <if test="status != null">status,</if>
	        <if test="delflag != null">delflag,</if>
	        <if test="urgentlevel != null">urgentlevel,</if>
	        <if test="CCuserids != null and CCuserids != ''">CCuserids,</if>
	        <if test="CCusernames != null and CCusernames != ''">CCusernames,</if>
	    </trim>
	    <trim prefix="values(" suffix=")" suffixOverrides=",">
	        <if test="requestid != null and requestid != ''">#{requestid},</if>
	        <if test="companyid != null and companyid != ''">#{companyid},</if>
	        <if test="reason != null and reason != ''">#{reason},</if>
	        <if test="content != null and content != ''">#{content},</if>
	        <if test="examineuserid != null and examineuserid != ''">#{examineuserid},</if>
	        <if test="createtime != null and createtime != ''">#{createtime},</if>
	        <if test="createid != null and createid != ''">#{createid},</if>
	        <if test="status != null">#{status},</if>
	        <if test="delflag != null">#{delflag},</if>
	        <if test="urgentlevel != null">#{urgentlevel},</if>
	        <if test="CCuserids != null and CCuserids != ''">#{CCuserids},</if>
	        <if test="CCusernames != null and CCusernames != ''">#{CCusernames},</if>
	    </trim>
    </insert>
    <select id="getRequestList" parameterType="map" resultType="map">
        select 
	        ctfu.isread,ctfu.forwarduserid,ctur.requestid,ctur.companyid,ctur.reason,ctur.result,ctur.examineuserid,ctur.content,ctur.urgentlevel,
	        DATE_FORMAT(ctur.updatetime,'%Y-%m-%d %H:%i') as updatetime,ctur.updateid,ctur.status,ctur.opinion,ctur.createid,
	        DATE_FORMAT(ctfu.createtime,'%Y-%m-%d %H:%i') as createtime,
        	ctuu.realname as createname,ctuu.headimage AS createheadimage,
       		ctuu1.realname as examinename,ctuu1.headimage AS examineheadimage
        from c_t_use_request ctur
        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctur.requestid and resourcetype=16
        left join c_t_use_userinfo ctuu on ctur.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctur.examineuserid=ctuu1.userid
        <where>
            <if test="companyid != null and companyid !=''">and ctur.companyid=#{companyid}</if>
            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="status != null">and ctur.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt;= concat(#{starttime}," 00:00:00")</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt;= concat(#{endtime}," 23:59:59")</if>
            and ctur.delflag=0 and ctfu.delflag=0
        </where>
        order by ctur.createtime desc
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getRequestListNum" parameterType="map" resultType="int">
        select count(0) from c_t_use_request ctur
        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctur.requestid and resourcetype=16
        left join c_t_use_userinfo ctuu on ctur.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctur.examineuserid=ctuu1.userid
        <where>
            <if test="companyid != null and companyid !=''">and ctur.companyid=#{companyid}</if>
            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="status != null">and ctur.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt;= concat(#{starttime}," 00:00:00")</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt;= concat(#{endtime}," 23:59:59")</if>
	        <if test="isread != null">and ctfu.isread=#{isread}</if>
            and ctur.delflag=0 and ctfu.delflag=0
        </where>
    </select>
    
    <!-- 查询请示信息的时间列表 -->
    <select id="getRequestTimesList" parameterType="map" resultType="map">
    	select 
        	distinct DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') as createtime
        from c_t_use_request ctur
        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctur.requestid and resourcetype=16
        left join c_t_use_userinfo ctuu on ctur.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctur.examineuserid=ctuu1.userid
        <where>
            <if test="companyid != null and companyid !=''">and ctur.companyid=#{companyid}</if>
            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="status != null">and ctur.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt;= concat(#{starttime}," 00:00:00")</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt;= concat(#{endtime}," 23:59:59")</if>
            and ctur.delflag=0 and ctfu.delflag=0
        </where>
        order by ctur.createtime desc
        <if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
    </select>
    
    <!-- 查询请示信息的时间列表的总数 -->
    <select id="getRequestTimesCount" parameterType="map" resultType="int">
    	select count(*)
    	from(
    		select 
	        	distinct DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') as createtime
	        from c_t_use_request ctur
	        left join c_t_use_forward_user ctfu on ctfu.resourceid=ctur.requestid and resourcetype=16
	        left join c_t_use_userinfo ctuu on ctur.createid=ctuu.userid
	        left join c_t_use_userinfo ctuu1 on ctur.examineuserid=ctuu1.userid
	        <where>
	            <if test="companyid != null and companyid !=''">and ctur.companyid=#{companyid}</if>
	            <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
		        <if test="status != null">and ctur.status=#{status}</if>
		        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt;= concat(#{starttime}," 00:00:00")</if>
		        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt;= concat(#{endtime}," 23:59:59")</if>
		        <if test="isread != null">and ctfu.isread=#{isread}</if>
	            and ctur.delflag=0 and ctfu.delflag=0
	        </where>
    	) request
    </select>
    
    <select id="getRequestInfo" parameterType="map" resultType="map">
        select ctur.requestid,ctur.companyid,ctur.reason,ctur.result,ctur.examineuserid,ctur.content,ctur.urgentlevel,
        DATE_FORMAT(ctur.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctur.updateid,ctur.status,ctur.opinion,ctur.createid,
        DATE_FORMAT(ctur.createtime,'%Y-%m-%d %H:%i:%S') as createtime,
  		ctuu.realname as createname,ctuu.headimage AS createheadimage,ctuu.phone as createphone,
       	ctuu1.realname as examinename,ctuu1.headimage AS examineheadimage,ctuu1.phone as examinephone,
       	ctur.CCuserids,IFNULL(ctur.CCusernames,"") as CCusernames
        from c_t_use_request ctur
        left join c_t_use_userinfo ctuu on ctur.createid=ctuu.userid
        left join c_t_use_userinfo ctuu1 on ctur.examineuserid=ctuu1.userid
        <where>
            <if test="requestid != null and requestid !=''">and ctur.requestid=#{requestid}</if>
        </where>
        limit 1
    </select>
    <update id="updateRequest" parameterType="map">
        update c_t_use_request
        <set>
            <if test="updatetime !=null and updatetime != ''">updatetime=#{updatetime},</if>
            <if test="updateid !=null and updateid != ''">updateid=#{updateid},</if>
            <if test="delflag != null">delflag=#{delflag},</if>
            <if test="opinion != null and opinion != ''">opinion=#{opinion},</if>
            <if test="result != null">result=#{result},</if>
            <if test="status != null">status=#{status},</if>
        </set>
        where requestid=#{requestid}
    </update>
    <select id="getBriefNotreadNum" parameterType="map" resultType="int">
        select count(0) from c_t_use_releaserange_user cturu
        left join c_t_use_module_brief ctumb on cturu.resourceid=ctumb.briefid
	    <where>
	        <if test="userid != null and userid != ''">and cturu.userid=#{userid}</if>
	        <if test="isread != null">and cturu.isread=#{isread}</if>
	        <if test="resourcetype != null">and  cturu.resourcetype=#{resourcetype}</if>
	        <if test="moduleid != null and moduleid != ''">and  ctumb.moduleid=#{moduleid}</if>
	        and cturu.delflag=0
	    </where>
    </select>
    
    <!-- 使用方后台查询企业简报 -->
    <select id="getBriefListInfo" parameterType="map" resultType="map">
    	select
    		briefid,moduleid,title,SUBSTRING_INDEX(content,"。","1") as content,createid,DATE_FORMAT(createtime,"%Y-%m-%d %H:%i") as createtime
    	from c_t_use_module_brief
    	<where>
    		delflag=0
    		<if test="moduleid != null and moduleid != ''">and moduleid=#{moduleid}</if>
    		<if test="briefid != null and briefid != ''">and briefid=#{briefid}</if>
    		<if test="title != null and title != ''">and locate(#{title},title) > 0</if>
    	</where>
    	order by createtime desc
    	<if test="startnum != null and rownum != ''">limit #{startnum},#{rownum}</if>
    </select>
    <select id="getBriefListCount" parameterType="map" resultType="int">
    	select
    		COUNT(0)
    	FROM c_t_use_module_brief
    	<where>
    		delflag=0
    		<if test="moduleid != null and moduleid != ''">and moduleid=#{moduleid}</if>
    		<if test="briefid != null and briefid != ''">and briefid=#{briefid}</if>
    		<if test="title != null and title != ''">and locate(#{title},title) > 0</if>
    	</where>
    </select>
    
    <!-- 备用金 已处理 -->
	<select id="getReserveAmountByDate" parameterType="map" resultType="map">
	    select DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createtime,COUNT(0) as count
	    from c_t_use_reserveamount ctao
	    right join c_t_use_forward_user ctfu on ctfu.resourceid=ctao.reserveamountid and resourcetype=20
		<where>
		    <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctao.companyid=#{companyid}</if>
	        <if test="status != null">and ctao.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
	        and ctfu.delflag=0 and ctfu.delflag=0
	    </where>
	    group by DATE_FORMAT(ctfu.createtime,'%Y-%m-%d')
	    order by DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') desc
		<if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
	</select>
	<select id="getReserveAmountByDateNum" parameterType="map" resultType="int">
	    select count(0) from (select DATE_FORMAT(ctfu.createtime,'%Y-%m-%d') AS createtime,COUNT(0) as count
	    from c_t_use_reserveamount ctao
	    right join c_t_use_forward_user ctfu on ctfu.resourceid=ctao.reserveamountid and resourcetype=20
		<where>
		    <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctao.companyid=#{companyid}</if>
	        <if test="status != null">and ctao.status=#{status}</if>
	        <if test="starttime != null and starttime != ''">and ctfu.createtime &gt; #{starttime}</if>
	        <if test="endtime != null and endtime != ''">and ctfu.createtime &lt; #{endtime}</if>
	        <if test="isread != null">and ctfu.isread=#{isread}</if>
	        and ctfu.delflag=0 and ctfu.delflag=0
	    </where>
	    group by DATE_FORMAT(ctfu.createtime,'%Y-%m-%d')
	    ) b
	</select>
	
	<select id="getReserveByDate" parameterType="map" resultType="map">
	    select ctfu.isread,ctfu.forwarduserid,ctao.reserveamountid,ctao.companyid,ctao.reason,ctao.urgentlevel,ctao.examineuserid,ctao.createid,ctao.opinion,ctao.result,DATE_FORMAT(ctao.createtime,'%H:%i:%S') as createtime,DATE_FORMAT(ctao.updatetime,'%Y-%m-%d %H:%i:%S') as updatetime,ctao.updateid,ctao.status,
	    ctao.amount,ctao.usetime,ctao.returntime,ctao.returntime,ctao.remark,
	    ctuu.realname as createname,ctuu1.realname as examinename,
	    ctuu.headimage as createheadimage,ctuu1.headimage as examineheadimage
	    from c_t_use_reserveamount ctao
	    right join c_t_use_forward_user ctfu on ctfu.resourceid=ctao.reserveamountid and resourcetype=20
	    left join c_t_use_userinfo ctuu on ctao.createid=ctuu.userid
	    left join c_t_use_userinfo ctuu1 on ctao.examineuserid=ctuu1.userid
	    <where>
	        <if test="userid != null and userid != ''">and ctfu.receiveid=#{userid}</if>
	        <if test="companyid != null and companyid != ''">and ctao.companyid=#{companyid}</if>
	        <if test="status != null">and ctao.status=#{status}</if>
	        <if test="createtime != null and createtime != ''">and DATE_FORMAT(ctfu.createtime,'%Y-%m-%d')=#{createtime}</if>
	        and ctfu.delflag=0 and ctfu.delflag=0
	    </where>
	    order by ctfu.createtime desc
	</select>
	
	<!-- 查询公司的企业网盘信息 -->
	<select id="getCompanyCloudInfo" parameterType="map" resultType="map">
		select 
			cloudid,companyid,maxmemory,usedmemory,shujudmemory,qywpdmemory,gmdmemory
		from c_t_use_company_cloud
		where companyid=#{companyid} and delflag=0
		limit 1
	</select>	
	
	<!-- 扩容 -->
	<insert id="insertCloudCapacityInfo" parameterType="map">
		insert into c_t_manage_cloud_capacity
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="capacityid != null and capacityid != ''">capacityid,</if>
			<if test="cloudid != null and cloudid != ''">cloudid,</if>
			<if test="memory != null and memory != ''">memory,</if>
			<if test="sjmemory != null and sjmemory != ''">sjmemory,</if>
			<if test="status != null">status,</if>
			
			<if test="refusereason != null and refusereason != ''">refusereason,</if>
			<if test="createid != null and createid != ''">createid,</if>
			<if test="delflag != null">delflag,</if>
			<if test="createtime != null and createtime != ''">createtime,</if>
			<if test="updatetime != null and updatetime != ''">updatetime,</if>
			
			<if test="updateid != null and updateid != ''">updateid,</if>
		</trim>
		<trim prefix="values(" suffix=")" suffixOverrides=",">
			<if test="capacityid != null and capacityid != ''">#{capacityid},</if>
			<if test="cloudid != null and cloudid != ''">#{cloudid},</if>
			<if test="memory != null and memory != ''">#{memory},</if>
			<if test="sjmemory != null and sjmemory != ''">#{sjmemory},</if>
			<if test="status != null">#{status},</if>
			
			<if test="refusereason != null and refusereason != ''">#{refusereason},</if>
			<if test="createid != null and createid != ''">#{createid},</if>
			<if test="delflag != null">#{delflag},</if>
			<if test="createtime != null and createtime != ''">#{createtime},</if>
			<if test="updatetime != null and updatetime != ''">#{updatetime},</if>
			
			<if test="updateid != null and updateid != ''">#{updateid},</if>
		</trim>
	</insert>
	
	<!-- 查询扩容记录信息 -->
	<select id="getCloudCapacityList" parameterType="map" resultType="map">
		select
			ccc1.capacityid,ccc1.memory,ccc1.sjmemory,ccc1.status,ccc1.refusereason,date_format(ccc1.createtime,"%Y-%m-%d") as createtime
		from c_t_use_company_cloud ccc
		left join c_t_manage_cloud_capacity ccc1 on ccc.cloudid=ccc1.cloudid
		where ccc.companyid=#{companyid} and ccc.delflag=0 and ccc1.delflag=0
		order by ccc1.createtime desc
		<if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
	</select>
	<select id="getCloudCapacityCount" parameterType="map" resultType="int">
		select
			count(*)
		from c_t_use_company_cloud ccc
		left join c_t_manage_cloud_capacity ccc1 on ccc.cloudid=ccc1.cloudid
		where ccc.companyid=#{companyid} and ccc.delflag=0 and ccc1.delflag=0
	</select>
	<select id="getCloudCapacitySjmemoryCount" parameterType="map" resultType="string">
		select
			sum(ccc1.sjmemory)
		from c_t_use_company_cloud ccc
		left join c_t_manage_cloud_capacity ccc1 on ccc.cloudid=ccc1.cloudid
		where ccc.companyid=#{companyid} and ccc.delflag=0 and ccc1.delflag=0
	</select>
	
	<!-- 修改云盘文件夹 -->
	<update id="updateCompanyCloudModuleInfo" parameterType="map">
		update c_t_use_companycloud_module
		<set>
			<if test="modulename != null and modulename != ''">modulename=#{modulename},</if>
			<if test="moduleimage != null and moduleimage != ''">moduleimage=#{moduleimage},</if>
			<if test="delflag != null">delflag=#{delflag},</if>
			<if test="updatetime != null and updatetime != ''">updatetime=#{updatetime},</if>
			<if test="updateid != null and updateid != ''">updateid=#{updateid},</if>
		</set>
		where moduleid=#{moduleid}
	</update>
	
	
	<select id="getCompanyCloudFileList" parameterType="map" resultType="map">
		select 
			clf.fileid,clf.title,clf.content,date_format(clf.createtime,"%Y-%m-%d %H:%i") as createtime,clf.moduleid
        from  c_t_manage_cloud_file clf 
        left join c_t_use_release_range crr on crr.resourceid=clf.fileid and crr.resourcetype=13
        <where>
        	<if test="organizeid != null and organizeid != ''">and crr.organizeid=#{organizeid}</if>
        	<if test="moduleid != null and moduleid != ''">and clf.moduleid=#{moduleid}</if>
        	<if test="companyid != null and companyid != ''">and crr.companyid=#{companyid}</if>
        	<if test="title != null and title != ''">and locate(#{title},clf.title) > 0</if>
        	and crr.delflag=0 and clf.delflag=0 and clf.filetype=1
        	group by clf.fileid
        	order by clf.createtime desc
        	<if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
        </where>
	</select>
	<select id="getCompanyCloudFileListCount" parameterType="map" resultType="int">
		select 
			count(*)
		from (
			select 
				clf.fileid,clf.title,clf.content,date_format(clf.createtime,"%Y-%m-%d %H:%i") as createtime,clf.moduleid
	        from  c_t_manage_cloud_file clf 
	        left join c_t_use_release_range crr on crr.resourceid=clf.fileid and crr.resourcetype=13
	        <where>
	        	<if test="organizeid != null and organizeid != ''">and crr.organizeid=#{organizeid}</if>
	        	<if test="moduleid != null and moduleid != ''">and clf.moduleid=#{moduleid}</if>
	        	<if test="companyid != null and companyid != ''">and crr.companyid=#{companyid}</if>
	        	<if test="title != null and title != ''">and locate(#{title},clf.title) > 0</if>
	        	and crr.delflag=0 and clf.delflag=0 and clf.filetype=1
	        	group by clf.fileid
	        	order by clf.createtime desc
	        	<if test="startnum != null and rownum != null">limit #{startnum},#{rownum}</if>
	        </where>
		) fl
	</select>
	
	<insert id="insertCompanyCloudFileInfo" parameterType="map">
		insert into c_t_manage_cloud_file
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="fileid != null and fileid != ''">fileid,</if>
			<if test="cloudid != null and cloudid != ''">cloudid,</if>
			<if test="moduleid != null and moduleid != ''">moduleid,</if>
			<if test="filename != null and filename != ''">filename,</if>
			<if test="fileurl != null and fileurl != ''">fileurl,</if>
			
			<if test="memory != null and memory != ''">memory,</if>
			<if test="filetype != null and filetype != ''">filetype,</if>
			<if test="createid != null and createid != ''">createid,</if>
			<if test="delflag != null">delflag,</if>
			<if test="createtime != null and createtime != ''">createtime,</if>
			
			<if test="status != null">status,</if>
			<if test="title != null and title != ''">title,</if>
			<if test="content != null and content != ''">content,</if>
		</trim>
		<trim prefix="values(" suffix=")" suffixOverrides=",">
			<if test="fileid != null and fileid != ''">#{fileid},</if>
			<if test="cloudid != null and cloudid != ''">#{cloudid},</if>
			<if test="moduleid != null and moduleid != ''">#{moduleid},</if>
			<if test="filename != null and filename != ''">#{filename},</if>
			<if test="fileurl != null and fileurl != ''">#{fileurl},</if>
			
			<if test="memory != null and memory != ''">#{memory},</if>
			<if test="filetype != null and filetype != ''">#{filetype},</if>
			<if test="createid != null and createid != ''">#{createid},</if>
			<if test="delflag != null">#{delflag},</if>
			<if test="createtime != null and createtime != ''">#{createtime},</if>
			
			<if test="status != null">#{status},</if>
			<if test="title != null and title != ''">#{title},</if>
			<if test="content != null and content != ''">#{content},</if>
		</trim>
	</insert>
	
	<update id="updateCompanyCloudFileInfo" parameterType="map">
		update c_t_manage_cloud_file
		<set>
			<if test="filename != null and filename != ''">filename=#{filename},</if>
			<if test="fileurl != null and fileurl != ''">fileurl=#{fileurl},</if>
			<if test="memory != null and memory != ''">memory=#{memory},</if>
			<if test="delflag != null">delflag=#{delflag},</if>
			<if test="title != null and title != ''">title=#{title},</if>
			<if test="content != null and content != ''">content=#{content},</if>
		</set>
		where fileid=#{fileid}
	</update>
	
	<select id="getCompanyCloudFileInfo" parameterType="map" resultType="map">
		select
			ccf.fileid,cuu.realname,ccf.cloudid,ccf.filename,ccf.fileurl,ccf.memory,date_format(ccf.createtime,"%Y-%m-%d %H:%i") as createtime,
			ccf.moduleid,ccf.title,ccf.content
		from c_t_manage_cloud_file ccf
		left join c_t_use_userinfo cuu on cuu.userid=ccf.createid
		where ccf.moduleid=#{moduleid} and ccf.fileid=#{fileid}
		limit 1
	</select>
	
	<select id="getCompanyCloudDetail" parameterType="map" resultType="map">
		select
			ccf.fileid,cuu.realname,ccf.filename,ccf.fileurl,ccf.memory,date_format(ccf.createtime,"%Y-%m-%d %H:%i") as createtime,ccf.title,ccf.content
		from c_t_manage_systemcloud_file ccf
		left join c_t_use_userinfo cuu on cuu.userid=ccf.createid
		where ccf.fileid=#{fileid}
		limit 1
	</select>
	
	<update id="updateCompanyCloudUseMemoryInfo" parameterType="map">
		update c_t_use_company_cloud
		<set>
			<if test="usedmemory != null">usedmemory=usedmemory+#{usedmemory},</if>
			<if test="shujudmemory != null">shujudmemory=shujudmemory+#{shujudmemory},</if>
			<if test="qywpdmemory != null">qywpdmemory=qywpdmemory+#{qywpdmemory},</if>
		</set>
		where companyid=#{companyid}
	</update>
	
	<!-- 查询还有一个小时结束的任务信息 -->
	<select id="getOverTaskOneHour" parameterType="map" resultType="map">
		SELECT
			taskid,companyid,title,content,endtime,examineuserid,createid
		FROM c_t_use_task
		WHERE delflag=0 AND status=0
		AND DATE_FORMAT(endtime,"%Y-%m-%d %H:%i")=DATE_FORMAT(#{endtime},"%Y-%m-%d %H:%i")
	</select>
	
</mapper>